<div class="main-content">
    <div class="admin-dashboard">
        <!-- Header -->
        <div class="dashboard-header">
            <div class="header-content">
                <div class="header-title">
                    <div class="title-icon">üõí</div>
                    <div>
                        <h1>QU·∫¢N L√ù ƒê∆†N H√ÄNG</h1>
                        <p>Qu·∫£n l√Ω v√† theo d√µi ƒë∆°n h√†ng</p>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn-secondary" id="refreshBtn">
                        <i class="fas fa-sync-alt"></i>
                        <span>L√†m m·ªõi</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card stat-total">
                <div class="stat-icon">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="stat-details">
                    <div class="stat-value" id="totalOrders">0</div>
                    <div class="stat-label">T·ªïng ƒë∆°n h√†ng</div>
                </div>
            </div>
            <div class="stat-card stat-pending">
                <div class="stat-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-details">
                    <div class="stat-value" id="pendingOrders">0</div>
                    <div class="stat-label">Ch·ªù x√°c nh·∫≠n</div>
                </div>
            </div>
            <div class="stat-card stat-processing">
                <div class="stat-icon">
                    <i class="fas fa-cog"></i>
                </div>
                <div class="stat-details">
                    <div class="stat-value" id="processingOrders">0</div>
                    <div class="stat-label">ƒêang x·ª≠ l√Ω</div>
                </div>
            </div>
            <div class="stat-card stat-shipping">
                <div class="stat-icon">
                    <i class="fas fa-truck"></i>
                </div>
                <div class="stat-details">
                    <div class="stat-value" id="shippingOrders">0</div>
                    <div class="stat-label">ƒêang giao</div>
                </div>
            </div>
            <div class="stat-card stat-completed">
                <div class="stat-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-details">
                    <div class="stat-value" id="completedOrders">0</div>
                    <div class="stat-label">Ho√†n th√†nh</div>
                </div>
            </div>
            <div class="stat-card stat-cancelled">
                <div class="stat-icon">
                    <i class="fas fa-times-circle"></i>
                </div>
                <div class="stat-details">
                    <div class="stat-value" id="cancelledOrders">0</div>
                    <div class="stat-label">ƒê√£ h·ªßy</div>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters-section">
            <div class="filters-row">
                <div class="filter-group">
                    <label><i class="fas fa-search"></i> T√¨m ki·∫øm</label>
                    <input type="text" id="searchInput" class="form-control" placeholder="T√¨m m√£ ƒë∆°n h√†ng, kh√°ch h√†ng...">
                </div>
                <div class="filter-group">
                    <label><i class="fas fa-filter"></i> Tr·∫°ng th√°i</label>
                    <select id="statusFilter" class="form-select">
                        <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                        <option value="cho_xac_nhan">Ch·ªù x√°c nh·∫≠n</option>
                        <option value="dang_xu_ly">ƒêang x·ª≠ l√Ω</option>
                        <option value="dang_giao">ƒêang giao</option>
                        <option value="hoan_thanh">Ho√†n th√†nh</option>
                        <option value="huy">ƒê√£ h·ªßy</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label><i class="fas fa-map-marker-alt"></i> V√πng</label>
                    <select id="regionFilter" class="form-select">
                        <option value="">T·∫•t c·∫£ v√πng</option>
                        {{#each regions}}
                        <option value="{{this.ma_vung}}">{{this.ten_vung}}</option>
                        {{/each}}
                    </select>
                </div>
                <div class="filter-group">
                    <label><i class="fas fa-calendar"></i> T·ª´ ng√†y</label>
                    <input type="date" id="dateFrom" class="form-control">
                </div>
                <div class="filter-group">
                    <label><i class="fas fa-calendar"></i> ƒê·∫øn ng√†y</label>
                    <input type="date" id="dateTo" class="form-control">
                </div>
                <div class="filter-actions">
                    <button class="btn btn-clear" id="clearFilters">
                        <i class="fas fa-eraser"></i> X√≥a b·ªô l·ªçc
                    </button>
                </div>
            </div>
        </div>

        <!-- Orders Table -->
        <div class="table-container">
            <div class="table-header">
                <h3><i class="fas fa-shopping-cart"></i> Danh s√°ch ƒë∆°n h√†ng</h3>
                <div class="table-actions">
                    <div class="search-box-inline">
                        <i class="fas fa-search"></i>
                        <input type="text" id="tableSearchInput" placeholder="T√¨m trong b·∫£ng...">
                    </div>
                </div>
            </div>

            <div class="table-responsive">
                <table class="products-table" id="ordersTable">
                    <thead>
                        <tr>
                            <th style="width: 15%">M√É ƒê∆†N H√ÄNG</th>
                            <th style="width: 18%">KH√ÅCH H√ÄNG</th>
                            <th style="width: 10%">V√ôNG</th>
                            <th style="width: 12%">T·ªîNG TI·ªÄN</th>
                            <th style="width: 12%">TR·∫†NG TH√ÅI</th>
                            <th style="width: 13%">NG√ÄY T·∫†O</th>
                            <th style="width: 20%">THAO T√ÅC</th>
                        </tr>
                    </thead>
                    <tbody id="ordersTableBody">
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="emptyState" style="display: none;">
                <div class="empty-icon">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <h3>Ch∆∞a c√≥ ƒë∆°n h√†ng</h3>
                <p>Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o trong h·ªá th·ªëng</p>
            </div>

            <!-- Pagination -->
            <div class="pagination-section" id="paginationSection">
                <div class="pagination-info">
                    <span>Hi·ªÉn th·ªã <strong id="showingFrom">0</strong> - <strong id="showingTo">0</strong> trong t·ªïng s·ªë <strong id="totalRecords">0</strong> ƒë∆°n h√†ng</span>
                </div>
                <div class="pagination-controls">
                    <button class="btn btn-pagination" id="prevPage" disabled>
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <div class="page-numbers" id="pageNumbers">
                        <!-- Page numbers will be generated by JS -->
                    </div>
                    <button class="btn btn-pagination" id="nextPage" disabled>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Detail Modal -->
    <div class="modal fade" id="orderDetailModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-shopping-cart"></i> Chi ti·∫øt ƒë∆°n h√†ng <span id="modalOrderCode"></span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="order-detail-grid">
                        <!-- Customer Info -->
                        <div class="detail-section">
                            <h6><i class="fas fa-user"></i> Th√¥ng tin kh√°ch h√†ng</h6>
                            <div class="detail-content">
                                <p><strong>T√™n:</strong> <span id="customerName"></span></p>
                                <p><strong>Email:</strong> <span id="customerEmail"></span></p>
                                <p><strong>SƒêT:</strong> <span id="customerPhone"></span></p>
                            </div>
                        </div>

                        <!-- Delivery Info -->
                        <div class="detail-section">
                            <h6><i class="fas fa-map-marker-alt"></i> ƒê·ªãa ch·ªâ giao h√†ng</h6>
                            <div class="detail-content">
                                <p id="deliveryAddress"></p>
                            </div>
                        </div>

                        <!-- Order Info -->
                        <div class="detail-section">
                            <h6><i class="fas fa-info-circle"></i> Th√¥ng tin ƒë∆°n h√†ng</h6>
                            <div class="detail-content">
                                <p><strong>V√πng:</strong> <span id="orderRegion"></span></p>
                                <p><strong>Kho xu·∫•t:</strong> <span id="orderWarehouse"></span></p>
                                <p><strong>Ph∆∞∆°ng th·ª©c v·∫≠n chuy·ªÉn:</strong> <span id="shippingMethod"></span></p>
                                <p><strong>Ng√†y t·∫°o:</strong> <span id="orderCreatedDate"></span></p>
                            </div>
                        </div>

                        <!-- Status -->
                        <div class="detail-section">
                            <h6><i class="fas fa-tasks"></i> Tr·∫°ng th√°i</h6>
                            <div class="detail-content">
                                <div class="status-update">
                                    <select class="form-select" id="orderStatusSelect">
                                        <option value="cho_xac_nhan">Ch·ªù x√°c nh·∫≠n</option>
                                        <option value="dang_xu_ly">ƒêang x·ª≠ l√Ω</option>
                                        <option value="dang_giao">ƒêang giao</option>
                                        <option value="hoan_thanh">Ho√†n th√†nh</option>
                                        <option value="huy">H·ªßy</option>
                                    </select>
                                    <button class="btn btn-primary btn-sm" id="updateStatusBtn">
                                        <i class="fas fa-save"></i> C·∫≠p nh·∫≠t
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Order Items -->
                    <div class="order-items-section">
                        <h6><i class="fas fa-box"></i> S·∫£n ph·∫©m trong ƒë∆°n h√†ng</h6>
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>S·∫£n ph·∫©m</th>
                                    <th>ƒê∆°n gi√°</th>
                                    <th>S·ªë l∆∞·ª£ng</th>
                                    <th>Th√†nh ti·ªÅn</th>
                                </tr>
                            </thead>
                            <tbody id="orderItemsTable">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Order Summary -->
                    <div class="order-summary">
                        <div class="summary-row">
                            <span>T·ªïng ti·ªÅn h√†ng:</span>
                            <strong id="summarySubtotal">0 ‚Ç´</strong>
                        </div>
                        <div class="summary-row">
                            <span>Ph√≠ v·∫≠n chuy·ªÉn:</span>
                            <strong id="summaryShipping">0 ‚Ç´</strong>
                        </div>
                        <div class="summary-row discount">
                            <span>Gi·∫£m gi√° (Voucher):</span>
                            <strong id="summaryDiscount">0 ‚Ç´</strong>
                        </div>
                        <div class="summary-row total">
                            <span>T·ªïng thanh to√°n:</span>
                            <strong id="summaryTotal">0 ‚Ç´</strong>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Global regions data from server
window.REGIONS_DATA = [
    {{#each regions}}
    {
        ma_vung: '{{this.ma_vung}}',
        ten_vung: '{{this.ten_vung}}'
    }{{#unless @last}},{{/unless}}
    {{/each}}
];

class OrderManager {
    constructor() {
        this.orders = [];
        this.filteredOrders = [];
        this.currentPage = 1;
        this.itemsPerPage = 10;
        this.currentOrderId = null;
        
        this.init();
    }

    async init() {
        await this.loadOrders();
        this.bindEvents();
        this.updateStats();
        this.renderTable();
    }

    bindEvents() {
        document.getElementById('refreshBtn')?.addEventListener('click', () => this.loadOrders());
        document.getElementById('searchInput')?.addEventListener('input', () => this.filterOrders());
        document.getElementById('statusFilter')?.addEventListener('change', () => this.filterOrders());
        document.getElementById('regionFilter')?.addEventListener('change', () => this.filterOrders());
        document.getElementById('dateFrom')?.addEventListener('change', () => this.filterOrders());
        document.getElementById('dateTo')?.addEventListener('change', () => this.filterOrders());
        document.getElementById('clearFilters')?.addEventListener('click', () => this.clearFilters());
        document.getElementById('prevPage')?.addEventListener('click', () => this.goToPage(this.currentPage - 1));
        document.getElementById('nextPage')?.addEventListener('click', () => this.goToPage(this.currentPage + 1));
        document.getElementById('updateStatusBtn')?.addEventListener('click', () => this.updateOrderStatus());
    }

    async loadOrders() {
        try {
            const response = await fetch('/api/donhang');
            const data = await response.json();
            
            if (data.success) {
                this.orders = data.orders || [];
                this.filteredOrders = [...this.orders];
                this.updateStats();
                this.renderTable();
            }
        } catch (error) {
            console.error('Error loading orders:', error);
            this.showError('Kh√¥ng th·ªÉ t·∫£i danh s√°ch ƒë∆°n h√†ng');
        }
    }

    filterOrders() {
        const search = document.getElementById('searchInput').value.toLowerCase();
        const status = document.getElementById('statusFilter').value;
        const region = document.getElementById('regionFilter').value;
        const dateFrom = document.getElementById('dateFrom').value;
        const dateTo = document.getElementById('dateTo').value;

        this.filteredOrders = this.orders.filter(order => {
            const matchSearch = !search || 
                order.ma_don_hang.toLowerCase().includes(search) ||
                order.ho_ten?.toLowerCase().includes(search) ||
                order.email?.toLowerCase().includes(search);
            
            const matchStatus = !status || order.trang_thai === status;
            const matchRegion = !region || order.vung_don_hang === region;
            
            const orderDate = new Date(order.ngay_tao).toISOString().split('T')[0];
            const matchDateFrom = !dateFrom || orderDate >= dateFrom;
            const matchDateTo = !dateTo || orderDate <= dateTo;

            return matchSearch && matchStatus && matchRegion && matchDateFrom && matchDateTo;
        });

        this.currentPage = 1;
        this.renderTable();
    }

    clearFilters() {
        document.getElementById('searchInput').value = '';
        document.getElementById('statusFilter').value = '';
        document.getElementById('regionFilter').value = '';
        document.getElementById('dateFrom').value = '';
        document.getElementById('dateTo').value = '';
        this.filterOrders();
    }

    updateStats() {
        document.getElementById('totalOrders').textContent = this.orders.length;
        document.getElementById('pendingOrders').textContent = 
            this.orders.filter(o => o.trang_thai === 'cho_xac_nhan').length;
        document.getElementById('processingOrders').textContent = 
            this.orders.filter(o => o.trang_thai === 'dang_xu_ly').length;
        document.getElementById('shippingOrders').textContent = 
            this.orders.filter(o => o.trang_thai === 'dang_giao').length;
        document.getElementById('completedOrders').textContent = 
            this.orders.filter(o => o.trang_thai === 'hoan_thanh').length;
        document.getElementById('cancelledOrders').textContent = 
            this.orders.filter(o => o.trang_thai === 'huy').length;
    }

    renderTable() {
        const tbody = document.getElementById('ordersTableBody');
        const emptyState = document.getElementById('emptyState');
        const paginationSection = document.getElementById('paginationSection');

        if (this.filteredOrders.length === 0) {
            tbody.innerHTML = '';
            emptyState.style.display = 'flex';
            paginationSection.style.display = 'none';
            return;
        }

        emptyState.style.display = 'none';
        paginationSection.style.display = 'flex';

        const start = (this.currentPage - 1) * this.itemsPerPage;
        const end = start + this.itemsPerPage;
        const pageOrders = this.filteredOrders.slice(start, end);

        tbody.innerHTML = pageOrders.map(order => `
            <tr>
                <td><strong>${order.ma_don_hang}</strong></td>
                <td>
                    <div>${order.ho_ten || 'N/A'}</div>
                    <small class="text-muted">${order.email || ''}</small>
                </td>
                <td>${this.getRegionBadge(order.vung_don_hang)}</td>
                <td><strong>${this.formatCurrency(order.tong_thanh_toan)}</strong></td>
                <td>${this.getStatusBadge(order.trang_thai)}</td>
                <td>${this.formatDate(order.ngay_tao)}</td>
                <td>
                    <div style="display: flex; gap: 6px; justify-content: center; align-items: center;">
                        <button class="btn btn-sm btn-info" onclick="orderManager.viewOrderDetail('${order.id}')" title="Xem chi ti·∫øt">
                            <i class="fas fa-eye"></i>
                        </button>
                        ${order.trang_thai === 'cho_xac_nhan' ? `
                            <button class="btn btn-sm btn-success" onclick="orderManager.quickUpdateStatus('${order.id}', 'dang_xu_ly')" title="X√°c nh·∫≠n ƒë∆°n">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="orderManager.quickUpdateStatus('${order.id}', 'huy')" title="H·ªßy ƒë∆°n">
                                <i class="fas fa-times"></i>
                            </button>
                        ` : ''}
                    </div>
                </td>
            </tr>
        `).join('');

        this.updatePagination();
    }

    updatePagination() {
        const totalPages = Math.ceil(this.filteredOrders.length / this.itemsPerPage);
        const start = (this.currentPage - 1) * this.itemsPerPage + 1;
        const end = Math.min(start + this.itemsPerPage - 1, this.filteredOrders.length);

        document.getElementById('showingFrom').textContent = start;
        document.getElementById('showingTo').textContent = end;
        document.getElementById('totalRecords').textContent = this.filteredOrders.length;

        document.getElementById('prevPage').disabled = this.currentPage === 1;
        document.getElementById('nextPage').disabled = this.currentPage === totalPages;

        // Generate page numbers
        this.renderPageNumbers(totalPages);
    }

    renderPageNumbers(totalPages) {
        const pageNumbersDiv = document.getElementById('pageNumbers');
        const current = this.currentPage;
        const delta = 2; // Number of pages to show on each side of current page
        const range = [];
        const rangeWithDots = [];

        // Always show first page
        range.push(1);

        // Calculate range around current page
        for (let i = current - delta; i <= current + delta; i++) {
            if (i > 1 && i < totalPages) {
                range.push(i);
            }
        }

        // Always show last page if there are multiple pages
        if (totalPages > 1) {
            range.push(totalPages);
        }

        // Add dots where there are gaps
        let prev = 0;
        for (const i of range) {
            if (prev) {
                if (i - prev === 2) {
                    rangeWithDots.push(prev + 1);
                } else if (i - prev !== 1) {
                    rangeWithDots.push('...');
                }
            }
            rangeWithDots.push(i);
            prev = i;
        }

        // Generate HTML
        pageNumbersDiv.innerHTML = rangeWithDots.map(page => {
            if (page === '...') {
                return '<span class="page-dots">...</span>';
            }
            return `
                <button 
                    class="btn-page-number ${page === current ? 'active' : ''}" 
                    onclick="orderManager.goToPage(${page})"
                    ${page === current ? 'disabled' : ''}
                >
                    ${page}
                </button>
            `;
        }).join('');
    }

    goToPage(page) {
        const totalPages = Math.ceil(this.filteredOrders.length / this.itemsPerPage);
        if (page >= 1 && page <= totalPages) {
            this.currentPage = page;
            this.renderTable();
        }
    }

    async viewOrderDetail(orderId) {
        try {
            const response = await fetch(`/api/donhang/${orderId}`);
            const data = await response.json();
            
            if (data.success) {
                this.currentOrderId = orderId;
                this.showOrderDetailModal(data.order);
            }
        } catch (error) {
            console.error('Error loading order detail:', error);
            this.showError('Kh√¥ng th·ªÉ t·∫£i chi ti·∫øt ƒë∆°n h√†ng');
        }
    }

    showOrderDetailModal(order) {
        document.getElementById('modalOrderCode').textContent = order.ma_don_hang;
        document.getElementById('customerName').textContent = order.ho_ten || 'N/A';
        document.getElementById('customerEmail').textContent = order.email || 'N/A';
        document.getElementById('customerPhone').textContent = order.so_dien_thoai || 'N/A';
        document.getElementById('deliveryAddress').textContent = order.dia_chi_giao_hang || 'N/A';
        document.getElementById('orderRegion').textContent = this.getRegionName(order.vung_don_hang);
        document.getElementById('orderWarehouse').textContent = order.ten_kho || 'N/A';
        document.getElementById('shippingMethod').textContent = order.ten_phuong_thuc || 'N/A';
        document.getElementById('orderCreatedDate').textContent = this.formatDateTime(order.ngay_tao);
        document.getElementById('orderStatusSelect').value = order.trang_thai;

        // Order items - Display full order_details info with warehouse for split orders
        const isSplitOrder = order.is_split_order === 1 || order.is_split_order === true;
        
        const itemsHtml = order.items?.map(item => `
            <tr>
                <td>
                    <div style="text-align: left;">
                        <strong>${item.ten_san_pham || 'N/A'}</strong>
                        ${item.ten_bien_the ? `<br><small class="text-muted">Phi√™n b·∫£n: ${item.ten_bien_the}</small>` : ''}
                        ${item.ma_sku ? `<br><small class="text-muted">SKU: ${item.ma_sku}</small>` : ''}
                        ${isSplitOrder && item.ten_kho_xuat ? `<br><small class="text-muted" style="color: #667eea; font-weight: 600;"><i class="fas fa-warehouse"></i> Xu·∫•t t·ª´: ${item.ten_kho_xuat} (${this.getRegionName(item.warehouse_region)})</small>` : ''}
                    </div>
                </td>
                <td>${this.formatCurrency(item.don_gia)}</td>
                <td>${item.so_luong}</td>
                <td><strong>${this.formatCurrency(item.thanh_tien)}</strong></td>
            </tr>
        `).join('') || '<tr><td colspan="4" style="text-align: center;">Kh√¥ng c√≥ s·∫£n ph·∫©m</td></tr>';
        
        document.getElementById('orderItemsTable').innerHTML = itemsHtml;

        // Summary
        document.getElementById('summarySubtotal').textContent = this.formatCurrency(order.tong_tien_hang);
        document.getElementById('summaryShipping').textContent = this.formatCurrency(order.phi_van_chuyen);
        document.getElementById('summaryDiscount').textContent = this.formatCurrency(order.gia_tri_giam_voucher);
        document.getElementById('summaryTotal').textContent = this.formatCurrency(order.tong_thanh_toan);

        const modal = new bootstrap.Modal(document.getElementById('orderDetailModal'));
        modal.show();
    }

    async quickUpdateStatus(orderId, newStatus) {
        const statusText = {
            'dang_xu_ly': 'x√°c nh·∫≠n',
            'huy': 'h·ªßy'
        };
        
        const confirmed = await Swal.fire({
            title: `B·∫°n c√≥ ch·∫Øc mu·ªën ${statusText[newStatus]} ƒë∆°n h√†ng n√†y?`,
            icon: 'question',
            showCancelButton: true,
            confirmButtonText: 'ƒê·ªìng √Ω',
            cancelButtonText: 'H·ªßy',
            confirmButtonColor: newStatus === 'huy' ? '#ef4444' : '#667eea'
        });

        if (!confirmed.isConfirmed) return;

        try {
            const response = await fetch(`/api/donhang/${orderId}/status`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ trang_thai: newStatus })
            });

            const data = await response.json();
            
            if (data.success) {
                this.showSuccess(`ƒê√£ ${statusText[newStatus]} ƒë∆°n h√†ng th√†nh c√¥ng`);
                await this.loadOrders();
            } else {
                this.showError(data.message || 'Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i');
            }
        } catch (error) {
            console.error('Error updating status:', error);
            this.showError('Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i');
        }
    }

    async updateOrderStatus() {
        if (!this.currentOrderId) return;

        const newStatus = document.getElementById('orderStatusSelect').value;
        
        try {
            const response = await fetch(`/api/donhang/${this.currentOrderId}/status`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ trang_thai: newStatus })
            });

            const data = await response.json();
            
            if (data.success) {
                this.showSuccess('C·∫≠p nh·∫≠t tr·∫°ng th√°i th√†nh c√¥ng');
                await this.loadOrders();
                bootstrap.Modal.getInstance(document.getElementById('orderDetailModal')).hide();
            } else {
                this.showError(data.message || 'Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i');
            }
        } catch (error) {
            console.error('Error updating status:', error);
            this.showError('Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i');
        }
    }

    getStatusBadge(status) {
        const badges = {
            'cho_xac_nhan': '<span class="badge badge-warning">Ch·ªù x√°c nh·∫≠n</span>',
            'dang_xu_ly': '<span class="badge badge-info">ƒêang x·ª≠ l√Ω</span>',
            'dang_giao': '<span class="badge badge-primary">ƒêang giao</span>',
            'hoan_thanh': '<span class="badge badge-success">Ho√†n th√†nh</span>',
            'huy': '<span class="badge badge-danger">ƒê√£ h·ªßy</span>'
        };
        return badges[status] || status;
    }

    getRegionBadge(region) {
        const badges = {
            'bac': '<span class="badge bg-primary">Mi·ªÅn B·∫Øc</span>',
            'trung': '<span class="badge bg-warning">Mi·ªÅn Trung</span>',
            'nam': '<span class="badge bg-success">Mi·ªÅn Nam</span>'
        };
        return badges[region] || region;
    }

    getRegionName(region) {
        const names = {
            'bac': 'Mi·ªÅn B·∫Øc',
            'trung': 'Mi·ªÅn Trung',
            'nam': 'Mi·ªÅn Nam'
        };
        return names[region] || region;
    }

    formatCurrency(amount) {
        return new Intl.NumberFormat('vi-VN', {
            style: 'currency',
            currency: 'VND'
        }).format(amount || 0);
    }

    formatDate(date) {
        return new Date(date).toLocaleDateString('vi-VN');
    }

    formatDateTime(date) {
        return new Date(date).toLocaleString('vi-VN');
    }

    showSuccess(message) {
        Swal.fire({
            icon: 'success',
            title: 'Th√†nh c√¥ng!',
            text: message,
            timer: 2000,
            showConfirmButton: false
        });
    }

    showError(message) {
        Swal.fire({
            icon: 'error',
            title: 'L·ªói!',
            text: message
        });
    }
}

let orderManager;
document.addEventListener('DOMContentLoaded', () => {
    orderManager = new OrderManager();
    
    // ==================== AUTO-SELECT & LOCK REGION FILTER ====================
    // N·∫øu ch·ªâ c√≥ 1 v√πng, t·ª± ƒë·ªông ch·ªçn v√† kh√≥a region filter
    const regions = window.REGIONS_DATA || [];
    
    if (regions.length === 1) {
        console.log('‚úÖ Only 1 region found. Auto-selecting and locking region filter.');
        const regionFilter = document.getElementById('regionFilter');
        if (regionFilter && regionFilter.options.length === 2) { // "T·∫•t c·∫£ v√πng" + 1 region
            regionFilter.value = regions[0].ma_vung;
            regionFilter.disabled = true;
            regionFilter.style.cursor = 'not-allowed';
            regionFilter.style.backgroundColor = '#f3f4f6';
        }
    }
});
</script>

<style>
    /* Modern CSS Reset and Base Styles */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    :root {
        --primary: #667eea;
        --primary-dark: #5a6fd8;
        --secondary: #764ba2;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --dark: #1f2937;
        --light: #f8fafc;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-400: #9ca3af;
        --gray-500: #6b7280;
        --gray-600: #4b5563;
        --gray-700: #374151;
        --gray-800: #1f2937;
        --border-radius: 12px;
        --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        --transition: all 0.3s ease;
    }

    body {
        font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
        background: var(--light);
        color: var(--gray-800);
        line-height: 1.6;
    }

    .main-content {
        min-height: 100vh;
        padding: 24px;
        max-width: 100%;
    }

    /* Header Styles */
    .dashboard-header {
        background: white;
        border-radius: var(--border-radius);
        padding: 28px 32px;
        margin-bottom: 24px;
        box-shadow: var(--shadow);
        border: 1px solid var(--gray-200);
        position: relative;
        overflow: hidden;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .dashboard-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
    }

    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px;
        width: 100%;
    }

    .header-title {
        display: flex;
        align-items: center;
        gap: 16px;
    }

    .title-icon {
        font-size: 2.75rem;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .header-title h1 {
        margin: 0;
        font-size: 1.875rem;
        font-weight: 700;
        color: var(--gray-800);
    }

    .header-title p {
        margin: 4px 0 0 0;
        color: var(--gray-500);
        font-size: 1rem;
    }

    .header-actions {
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
    }

    /* Button Styles */
    .btn,
    .btn-primary {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 10px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        font-size: 0.95rem;
        transition: var(--transition);
        box-shadow: var(--shadow);
        text-decoration: none;
        position: relative;
        overflow: hidden;
    }

    .btn-primary::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        transition: left 0.5s;
    }

    .btn-primary:hover,
    .btn-refresh:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
    }

    .btn-refresh {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        font-size: 0.9rem;
        transition: var(--transition);
        box-shadow: var(--shadow);
    }

    .btn-clear {
        background: white;
        color: var(--gray-700);
        border: 2px solid var(--gray-300);
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 500;
        font-size: 0.9rem;
        transition: var(--transition);
    }

    .btn-clear:hover {
        background: var(--gray-100);
        border-color: var(--gray-400);
    }

    .btn-info {
        background: linear-gradient(135deg, #4facfe, #00f2fe);
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-weight: 600;
        font-size: 0.85rem;
        transition: var(--transition);
    }

    .btn-info:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(79, 172, 254, 0.4);
    }

    .btn-sm {
        padding: 6px 12px;
        font-size: 0.85rem;
    }

    .btn-success {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-weight: 600;
        font-size: 0.85rem;
        transition: var(--transition);
    }

    .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
    }

    .btn-danger {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-weight: 600;
        font-size: 0.85rem;
        transition: var(--transition);
    }

    .btn-danger:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
    }

    .btn-secondary {
        background: white;
        color: var(--gray-700);
        border: 2px solid var(--gray-300);
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 500;
        font-size: 0.9rem;
        transition: var(--transition);
    }

    .btn-secondary:hover {
        background: var(--gray-100);
        border-color: var(--gray-400);
        transform: translateY(-1px);
    }

    /* Stats Overview */
    .stats-overview,
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 24px;
    }

    .stat-card {
        background: white;
        border-radius: var(--border-radius);
        padding: 24px;
        display: flex;
        align-items: center;
        gap: 20px;
        box-shadow: var(--shadow);
        border: 1px solid var(--gray-200);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(to bottom, var(--primary), var(--secondary));
    }

    .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
    }

    .stat-icon {
        width: 70px;
        height: 70px;
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.75rem;
        box-shadow: var(--shadow);
    }

    .stat-icon.total,
    .stat-total .stat-icon {
        background: linear-gradient(135deg, #fed7d7, #feb2b2);
        color: #e53e3e;
    }

    .stat-icon.available,
    .stat-pending .stat-icon {
        background: linear-gradient(135deg, #f093fb, #f5576c);
        color: white;
    }

    .stat-icon.busy,
    .stat-processing .stat-icon {
        background: linear-gradient(135deg, #4facfe, #00f2fe);
        color: white;
    }

    .stat-icon.premium,
    .stat-shipping .stat-icon {
        background: linear-gradient(135deg, #43e97b, #38f9d7);
        color: white;
    }

    .stat-completed .stat-icon {
        background: linear-gradient(135deg, #fa709a, #fee140);
        color: white;
    }

    .stat-cancelled .stat-icon {
        background: linear-gradient(135deg, #ff0844, #ffb199);
        color: white;
    }

    .stat-info h3,
    .stat-details .stat-value {
        margin: 0;
        font-size: 2rem;
        color: var(--gray-800);
        font-weight: 700;
    }

    .stat-info p,
    .stat-details .stat-label {
        margin: 4px 0 0 0;
        color: var(--gray-500);
        font-weight: 500;
        font-size: 0.9rem;
    }

    /* Search and Filter */
    .search-filter-bar,
    .filters-section {
        background: white;
        border-radius: var(--border-radius);
        padding: 24px;
        margin-bottom: 24px;
        display: flex;
        gap: 20px;
        align-items: center;
        flex-wrap: wrap;
        box-shadow: var(--shadow);
        border: 1px solid var(--gray-200);
    }

    .filters-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        width: 100%;
        align-items: end;
    }

    .filter-group {
        display: flex;
        flex-direction: column;
    }

    .filter-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--gray-700);
        font-size: 0.95rem;
    }

    .filter-group label i {
        margin-right: 5px;
        color: var(--primary);
    }

    .filter-actions {
        display: flex;
        align-items: flex-end;
    }

    .search-box {
        display: flex;
        align-items: center;
        background: var(--gray-100);
        border-radius: 10px;
        padding: 12px 20px;
        flex: 1;
        min-width: 400px;
        border: 2px solid var(--gray-200);
        transition: var(--transition);
    }

    .search-box:focus-within {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .search-box i {
        color: var(--gray-400);
        margin-right: 12px;
    }

    .search-box input {
        border: none;
        background: none;
        outline: none;
        flex: 1;
        padding: 4px 0;
        font-size: 0.95rem;
        color: var(--gray-800);
    }

    .search-btn {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border: none;
        padding: 10px 24px;
        border-radius: 8px;
        cursor: pointer;
        margin-left: 12px;
        font-weight: 600;
        transition: var(--transition);
    }

    .search-btn:hover {
        transform: translateY(-1px);
    }

    .filter-controls {
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
    }

    .filter-select {
        padding: 10px 16px;
        border: 2px solid var(--gray-200);
        border-radius: 8px;
        background: white;
        color: var(--gray-700);
        min-width: 160px;
        cursor: pointer;
        transition: var(--transition);
        font-size: 0.9rem;
    }

    .filter-select:focus {
        border-color: var(--primary);
        outline: none;
    }

    .clear-filters {
        background: none;
        border: 2px solid var(--gray-200);
        color: var(--gray-600);
        padding: 10px 16px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
        transition: var(--transition);
    }

    .clear-filters:hover {
        background: var(--gray-100);
        border-color: var(--gray-300);
    }

    /* ===== TABLE CONTAINER ===== */
    .table-container {
        background: white;
        border-radius: var(--border-radius);
        padding: 24px;
        box-shadow: var(--shadow);
        border: 1px solid var(--gray-200);
    }

    .table-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 16px;
    }

    .table-header h3 {
        margin: 0;
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--gray-800);
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .table-actions {
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
    }

    /* ===== SEARCH BOX INLINE ===== */
    .search-box-inline {
        position: relative;
        display: inline-flex;
        align-items: center;
    }

    .search-box-inline i {
        position: absolute;
        left: 14px;
        color: var(--gray-400);
        font-size: 0.95rem;
        pointer-events: none;
    }

    .search-box-inline input {
        padding: 10px 16px 10px 42px;
        border: 1.5px solid var(--gray-300);
        border-radius: 8px;
        font-size: 0.95rem;
        width: 280px;
        transition: var(--transition);
        background: white;
    }

    .search-box-inline input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .search-box-inline input::placeholder {
        color: var(--gray-400);
    }

    /* ===== TABLE ===== */
    .table-responsive {
        overflow-x: auto;
        margin: 20px 0;
    }

    .products-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.95rem;
    }

    .products-table thead {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
    }

    .products-table th {
        padding: 14px 16px;
        text-align: center;
        font-weight: 600;
        font-size: 0.9rem;
        white-space: nowrap;
    }

    .products-table tbody tr {
        border-bottom: 1px solid var(--gray-200);
        transition: var(--transition);
    }

    .products-table tbody tr:hover {
        background: var(--gray-100);
    }

    .products-table td {
        padding: 14px 16px;
        color: var(--gray-700);
    }

    .text-center {
        text-align: center;
    }

    /* Table Column Styles */
    .col-image {
        width: 80px;
    }

    .col-name {
        min-width: 200px;
    }

    .col-sku {
        width: 120px;
    }

    .col-price {
        width: 120px;
    }

    .col-category,
    .col-brand {
        width: 120px;
    }

    .col-status {
        width: 140px;
    }

    .col-actions {
        width: 100px;
        text-align: center;
    }

    /* Table Content Styles */
    .product-table-image {
        width: 50px;
        height: 50px;
        border-radius: 8px;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--gray-100);
        margin: 0 auto;
    }

    .product-table-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .product-name {
        font-weight: 600;
        color: var(--gray-800);
        margin-bottom: 4px;
    }

    .price-info {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    .current-price {
        font-weight: 600;
        color: var(--primary);
        font-size: 0.95rem;
    }

    .original-price {
        font-size: 0.85rem;
        color: var(--gray-400);
        text-decoration: line-through;
    }

    .category-badge,
    .brand-badge {
        background: var(--gray-100);
        color: var(--gray-700);
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 0.85rem;
        font-weight: 500;
        display: inline-block;
        text-align: center;
    }

    .status-badge {
        padding: 6px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        display: inline-block;
    }

    /* Badge colors for order status */
    .badge,
    .status-badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.8rem;
        display: inline-block;
        text-transform: uppercase;
        letter-spacing: 0.3px;
    }

    .badge-warning {
        background: linear-gradient(135deg, #f093fb, #f5576c);
        color: white;
    }

    .badge-info {
        background: linear-gradient(135deg, #4facfe, #00f2fe);
        color: white;
    }

    .badge-primary {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
    }

    .badge-success {
        background: linear-gradient(135deg, #43e97b, #38f9d7);
        color: white;
    }

    .badge-danger {
        background: linear-gradient(135deg, #ff0844, #ffb199);
        color: white;
    }

    .bg-primary {
        background: var(--primary);
        color: white;
    }

    .bg-warning {
        background: var(--warning);
        color: white;
    }

    .bg-success {
        background: var(--success);
        color: white;
    }

    .text-muted {
        color: var(--gray-500) !important;
        font-size: 0.85rem;
    }

    .action-buttons {
        display: flex;
        gap: 6px;
        justify-content: center;
        align-items: center;
    }

    .btn-action {
        width: 32px;
        height: 32px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
        color: white;
        font-size: 0.9rem;
    }

    .btn-edit {
        background: var(--primary);
    }

    .btn-edit:hover {
        background: var(--primary-dark);
        transform: scale(1.1);
    }

    .btn-delete {
        background: var(--danger);
    }

    .btn-delete:hover {
        background: #dc2626;
        transform: scale(1.1);
    }

    /* Table Footer */
    .table-footer,
    .pagination-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 24px;
        border-top: 1px solid var(--gray-200);
        background: var(--gray-50);
    }

    .table-info,
    .pagination-info {
        color: var(--gray-600);
        font-size: 0.9rem;
    }

    .pagination-info strong {
        color: var(--gray-800);
        font-weight: 600;
    }

    .table-pagination,
    .pagination-controls {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .pagination-btn,
    .btn-pagination {
        width: auto;
        height: 36px;
        border: 1px solid var(--gray-300);
        background: white;
        border-radius: 6px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
        color: var(--gray-600);
        padding: 8px 12px;
        font-size: 0.9rem;
        font-weight: 500;
    }

    .pagination-btn:hover:not(:disabled),
    .btn-pagination:hover:not(:disabled) {
        background: var(--gray-100);
        border-color: var(--gray-400);
    }

    .pagination-btn:disabled,
    .btn-pagination:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .page-numbers {
        display: flex;
        gap: 6px;
        align-items: center;
    }

    .btn-page-number {
        min-width: 36px;
        height: 36px;
        border: 1px solid var(--gray-300);
        background: white;
        border-radius: 6px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
        color: var(--gray-700);
        padding: 0 10px;
        font-size: 0.9rem;
        font-weight: 500;
    }

    .btn-page-number:hover:not(:disabled) {
        background: var(--gray-100);
        border-color: var(--gray-400);
    }

    .btn-page-number.active {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border-color: var(--primary);
        cursor: default;
    }

    .page-dots {
        padding: 0 8px;
        color: var(--gray-400);
        font-size: 0.9rem;
        display: flex;
        align-items: center;
    }

    .pagination-info,
    .page-info {
        font-size: 0.9rem;
        color: var(--gray-600);
    }

    .page-info strong {
        color: var(--gray-800);
    }

    /* Empty State */
    .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 80px 40px;
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        border: 1px solid var(--gray-200);
        text-align: center;
    }

    .empty-icon {
        font-size: 4rem;
        margin-bottom: 20px;
        opacity: 0.7;
    }

    .empty-content h3 {
        margin: 0 0 8px 0;
        color: var(--gray-800);
        font-size: 1.5rem;
    }

    .empty-content p {
        margin: 0 0 24px 0;
        color: var(--gray-500);
    }

    /* Loading State */
    .loading-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 60px 20px;
    }

    .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid var(--gray-200);
        border-left: 4px solid var(--primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 16px;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Modal Styles */
    .modal-content {
        border: none;
        border-radius: 16px;
        box-shadow: var(--shadow-lg);
        overflow: hidden;
    }

    .modal-header {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border-bottom: none;
        padding: 24px 28px;
    }

    .modal-title {
        font-weight: 700;
        font-size: 1.4rem;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .modal-body {
        padding: 25px;
        max-height: 80vh;
        overflow-y: auto;
    }

    .modal-footer {
        border-top: 1px solid var(--gray-200);
        padding: 20px 28px;
        background: white;
    }

    .btn-close {
        filter: invert(1) grayscale(100%) brightness(200%);
    }

    .modal-premium .modal-content {
        border: none;
        border-radius: 16px;
        box-shadow: var(--shadow-lg);
        overflow: hidden;
    }

    .modal-premium .modal-header {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border-bottom: none;
        padding: 24px 28px;
    }

    .modal-premium .modal-title {
        font-weight: 700;
        font-size: 1.4rem;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .modal-premium .modal-body {
        padding: 10px;
        max-height: 80vh;
        overflow-y: auto;
    }

    .modal-premium .modal-footer {
        border-top: 1px solid var(--gray-200);
        padding: 5px 28px;
        background: white;
    }

    .modal-premium .btn-close {
        filter: invert(1) grayscale(100%) brightness(200%);
    }

    /* Order Detail Styles */
    .order-detail-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 25px;
    }

    .detail-section {
        background: var(--gray-50);
        padding: 20px;
        border-radius: 12px;
        border-left: 4px solid var(--primary);
    }

    .detail-section h6 {
        font-weight: 700;
        color: var(--gray-800);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 1.05rem;
    }

    .detail-section h6 i {
        color: var(--primary);
    }

    .detail-content p {
        margin-bottom: 10px;
        color: var(--gray-700);
        font-size: 0.95rem;
        line-height: 1.6;
    }

    .detail-content strong {
        color: var(--gray-800);
        font-weight: 600;
    }

    .status-update {
        display: flex;
        gap: 10px;
    }

    .status-update .form-select {
        flex: 1;
    }

    .order-items-section {
        margin: 25px 0;
    }

    .order-items-section h6 {
        font-weight: 700;
        color: var(--gray-800);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 1.05rem;
    }

    .order-items-section h6 i {
        color: var(--primary);
    }

    .table-sm th {
        background: var(--gray-50);
        color: var(--gray-800);
        font-weight: 600;
        padding: 12px;
        text-align: center;
    }

    .table-sm td {
        padding: 12px;
        text-align: center;
    }

    .order-summary {
        background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-100) 100%);
        padding: 25px;
        border-radius: 12px;
        border: 2px solid var(--gray-200);
    }

    .summary-row {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid var(--gray-300);
        font-size: 1rem;
    }

    .summary-row:last-child {
        border-bottom: none;
    }

    .summary-row.total {
        font-size: 1.25rem;
        color: var(--danger);
        font-weight: 700;
        padding-top: 15px;
        border-top: 2px solid var(--gray-300);
        margin-top: 10px;
    }

    .summary-row.discount {
        color: var(--success);
    }

    /* Form Styles */
    .form-sections {
        display: flex;
        flex-direction: column;
        gap: 24px;
    }

    .form-section {
        background: var(--gray-50);
        border-radius: 12px;
        padding: 0 20px;
    }

    .section-title {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 16px;
        color: var(--gray-700);
        font-size: 1.1rem;
        font-weight: 600;
    }

    .section-title i {
        color: var(--primary);
    }

    .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
    }

    .form-group {
        margin-bottom: 0;
    }

    .form-label {
        font-weight: 600;
        color: var(--gray-700);
        margin: 8px 0px 3px 0px;
        font-size: 0.95rem;
        display: block;
    }

    .form-control,
    .form-select {
        border: 2px solid var(--gray-200);
        border-radius: 8px;
        padding: 12px;
        font-size: 0.95rem;
        transition: var(--transition);
        background: white;
        width: 100%;
    }

    .form-control:focus,
    .form-select:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        outline: none;
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
        .table-responsive {
            overflow-x: auto;
        }

        .products-table {
            min-width: 1000px;
        }
    }

    @media (max-width: 768px) {
        .main-content {
            padding: 16px;
        }

        .header-content {
            flex-direction: column;
            text-align: center;
        }

        .header-actions {
            justify-content: center;
            width: 100%;
        }

        .search-filter-bar {
            flex-direction: column;
        }

        .search-box {
            min-width: auto;
            width: 100%;
        }

        .filter-controls {
            width: 100%;
            justify-content: space-between;
        }

        .filter-select {
            flex: 1;
            min-width: auto;
        }

        .table-header {
            flex-direction: column;
            gap: 16px;
            align-items: flex-start;
        }

        .table-footer {
            flex-direction: column;
            gap: 16px;
            align-items: flex-start;
        }

        .form-grid {
            grid-template-columns: 1fr;
        }

        .stats-overview {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 480px) {
        .header-actions {
            flex-direction: column;
            width: 100%;
        }

        .btn-primary,
        .btn-secondary {
            width: 100%;
            justify-content: center;
        }

        .modal-premium .modal-footer {
            flex-direction: column;
            gap: 8px;
        }

        .modal-premium .btn {
            width: 100%;
            justify-content: center;
        }
    }
</style>
