<div class="main-content">
    <div class="admin-dashboard">
        <!-- Header -->
        <div class="dashboard-header">
            <div class="header-content">
                <div class="header-title">
                    <div class="title-icon">‚ö°</div>
                    <div>
                        <h1>QU·∫¢N L√ù FLASH SALE</h1>
                        <p>Theo d√µi v√† qu·∫£n l√Ω c√°c ch∆∞∆°ng tr√¨nh flash sale</p>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn-primary" id="addFlashSaleBtn">
                        <i class="fas fa-plus"></i>
                        <span>Th√™m Flash Sale</span>
                    </button>
                    <button class="btn-secondary" id="refreshBtn">
                        <i class="fas fa-sync-alt"></i>
                        <span>L√†m m·ªõi</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-overview">
            <div class="stat-card">
                <div class="stat-icon total">
                    <i class="fas fa-bolt"></i>
                </div>
                <div class="stat-info">
                    <h3 id="totalFlashSales">0</h3>
                    <p>T·ªïng Flash Sale</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon available">
                    <i class="fas fa-fire"></i>
                </div>
                <div class="stat-info">
                    <h3 id="countActive">0</h3>
                    <p>ƒêang di·ªÖn ra</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon busy">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-info">
                    <h3 id="countWaiting">0</h3>
                    <p>S·∫Øp di·ªÖn ra</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon premium">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-info">
                    <h3 id="countEnded">0</h3>
                    <p>ƒê√£ k·∫øt th√∫c</p>
                </div>
            </div>
        </div>

        <!-- Search and Filter -->
        <div class="search-filter-bar">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm flash sale theo t√™n...">
            </div>
            <div class="filter-controls">
                <select class="filter-select" id="statusFilter">
                    <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                    <option value="cho">‚è≥ Ch·ªù</option>
                    <option value="dang_dien_ra">üî• ƒêang di·ªÖn ra</option>
                    <option value="da_ket_thuc">‚úÖ ƒê√£ k·∫øt th√∫c</option>
                    <option value="huy">‚ùå ƒê√£ h·ªßy</option>
                </select>
                <button class="clear-filters" id="clearFilters">
                    <i class="fas fa-times"></i>
                    X√≥a l·ªçc
                </button>
            </div>
        </div>

        <!-- Flash Sales Table -->
        <div class="table-container">
            <div class="table-header">
                <h3>Danh s√°ch Flash Sale</h3>
                <div class="table-actions">
                    <button class="btn-export" id="exportBtn">
                        <i class="fas fa-download"></i>
                        Xu·∫•t Excel
                    </button>
                </div>
            </div>

            <div class="table-responsive">
                <table class="products-table" id="flashSalesTable">
                    <thead>
                        <tr>
                            <th class="col-name">T√™n Flash Sale</th>
                            <th class="col-date">Th·ªùi gian</th>
                            <th class="col-products">S·∫£n ph·∫©m</th>
                            <th class="col-sold">ƒê√£ b√°n</th>
                            <th class="col-status">Tr·∫°ng th√°i</th>
                            <th class="col-actions">Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#if flashSales.length}}
                        {{#each flashSales}}
                        <tr data-id="{{this.id}}" data-status="{{this.trang_thai}}">
                            <td class="col-name">
                                <div class="flashsale-name">{{this.ten_flash_sale}}</div>
                                {{#if this.mo_ta}}
                                <div class="flashsale-desc">{{this.mo_ta}}</div>
                                {{/if}}
                            </td>
                            <td class="col-date">
                                <div class="date-info">
                                    <div class="start-date">
                                        <i class="fas fa-play-circle"></i>
                                        {{formatDateTime this.ngay_bat_dau}}
                                    </div>
                                    <div class="end-date">
                                        <i class="fas fa-stop-circle"></i>
                                        {{formatDateTime this.ngay_ket_thuc}}
                                    </div>
                                </div>
                            </td>
                            <td class="col-products">
                                <span class="product-count">{{this.so_san_pham}} s·∫£n ph·∫©m</span>
                            </td>
                            <td class="col-sold">
                                <span class="sold-count">{{this.tong_da_ban}}</span>
                            </td>
                            <td class="col-status">
                                <span class="status-badge status-{{this.trang_thai}}">
                                    {{#if (eq this.trang_thai 'cho')}}‚è≥ Ch·ªù
                                    {{else if (eq this.trang_thai 'dang_dien_ra')}}üî• ƒêang di·ªÖn ra
                                    {{else if (eq this.trang_thai 'da_ket_thuc')}}‚úÖ ƒê√£ k·∫øt th√∫c
                                    {{else if (eq this.trang_thai 'huy')}}‚ùå ƒê√£ h·ªßy
                                    {{/if}}
                                </span>
                            </td>
                            <td class="col-actions">
                                <div class="action-buttons">
                                    <button class="btn-action btn-view" data-id="{{this.id}}" title="Xem chi ti·∫øt">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn-action btn-edit" data-id="{{this.id}}" title="Ch·ªânh s·ª≠a">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn-action btn-products" data-id="{{this.id}}" 
                                        data-name="{{this.ten_flash_sale}}" title="Qu·∫£n l√Ω s·∫£n ph·∫©m">
                                        <i class="fas fa-box"></i>
                                    </button>
                                    <button class="btn-action btn-delete" data-id="{{this.id}}" 
                                        data-name="{{this.ten_flash_sale}}" title="X√≥a">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {{/each}}
                        {{else}}
                        <tr>
                            <td colspan="6" class="emptyState">
                                <div class="empty-icon">‚ö°</div>
                                <div class="empty-content">
                                    <h3>Kh√¥ng t√¨m th·∫•y flash sale</h3>
                                    <p>Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c th√™m flash sale m·ªõi</p>
                                    <button class="btn-primary" id="addFlashSaleEmptyBtn">
                                        <i class="fas fa-plus"></i>
                                        Th√™m flash sale ƒë·∫ßu ti√™n
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {{/if}}
                    </tbody>
                </table>
            </div>

            <!-- Table Footer -->
            <div class="table-footer">
                <div class="table-info">
                    Hi·ªÉn th·ªã <span id="currentCount">{{flashSales.length}}</span> trong t·ªïng s·ªë <span
                        id="totalCount">{{flashSales.length}}</span> flash sale
                </div>
                <div class="table-pagination">
                    <button class="pagination-btn" id="prevPage" disabled>
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span class="pagination-info">Trang 1 c·ªßa 1</span>
                    <button class="pagination-btn" id="nextPage" disabled>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- Flash Sale Modal -->
    <div class="modal fade modal-premium" id="flashSaleModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-bolt"></i>
                        <span id="modalTitle">Th√™m Flash Sale m·ªõi</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="flashSaleForm">
                        <input type="hidden" id="flashSaleId">

                        <div class="form-sections">
                            <!-- Basic Information -->
                            <div class="form-section">
                                <h4 class="section-title">
                                    <i class="fas fa-info-circle"></i>
                                    Th√¥ng tin c∆° b·∫£n
                                </h4>
                                
                                <div class="form-group">
                                    <label for="flashSaleName" class="form-label">T√™n Flash Sale *</label>
                                    <input type="text" class="form-control" id="flashSaleName" required
                                        placeholder="Nh·∫≠p t√™n flash sale (VD: Flash Sale cu·ªëi tu·∫ßn)">
                                </div>

                                <div class="form-group">
                                    <label for="flashSaleDescription" class="form-label">M√¥ t·∫£</label>
                                    <textarea class="form-control" id="flashSaleDescription" rows="3"
                                        placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ ƒë·ª£t flash sale..."></textarea>
                                </div>
                            </div>

                            <!-- Time Range -->
                            <div class="form-section">
                                <h4 class="section-title">
                                    <i class="fas fa-clock"></i>
                                    Th·ªùi gian di·ªÖn ra
                                </h4>
                                <div class="form-grid-2">
                                    <div class="form-group">
                                        <label for="startDate" class="form-label">Ng√†y b·∫Øt ƒë·∫ßu *</label>
                                        <input type="datetime-local" class="form-control" id="startDate" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="endDate" class="form-label">Ng√†y k·∫øt th√∫c *</label>
                                        <input type="datetime-local" class="form-control" id="endDate" required>
                                    </div>
                                </div>
                            </div>

                            <!-- Status -->
                            <div class="form-section">
                                <h4 class="section-title">
                                    <i class="fas fa-cog"></i>
                                    Tr·∫°ng th√°i
                                </h4>
                                <div class="form-group">
                                    <label for="flashSaleStatus" class="form-label">Tr·∫°ng th√°i *</label>
                                    <select class="form-select" id="flashSaleStatus" required>
                                        <option value="cho">‚è≥ Ch·ªù</option>
                                        <option value="dang_dien_ra">üî• ƒêang di·ªÖn ra</option>
                                        <option value="da_ket_thuc">‚úÖ ƒê√£ k·∫øt th√∫c</option>
                                        <option value="huy">‚ùå H·ªßy</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i>
                        H·ªßy b·ªè
                    </button>
                    <button type="button" class="btn btn-primary" id="saveFlashSaleBtn">
                        <i class="fas fa-save"></i>
                        <span id="saveButtonText">Th√™m Flash Sale</span>
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- Products Management Modal -->
    <div class="modal fade modal-premium" id="productsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xxl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-box"></i>
                        <span id="productsModalTitle">Qu·∫£n l√Ω S·∫£n ph·∫©m Flash Sale</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="row">
                            <!-- Form Section -->
                            <div class="col-lg-5">
                                <div class="form-section-container">
                                    <div class="form-section">
                                        <h4 class="section-title">
                                            <i class="fas fa-edit"></i>
                                            <span id="productFormTitle">Th√™m s·∫£n ph·∫©m m·ªõi</span>
                                        </h4>

                                        <form id="productItemForm" class="product-form">
                                            <input type="hidden" id="flashSaleItemId">
                                            <input type="hidden" id="currentFlashSaleId">

                                            <div class="form-group">
                                                <label for="sanPham" class="form-label">
                                                    <i class="fas fa-box"></i>
                                                    S·∫£n ph·∫©m *
                                                </label>
                                                <select class="form-select form-select-lg" id="sanPham" required>
                                                    <option value="">-- Ch·ªçn s·∫£n ph·∫©m --</option>
                                                </select>
                                                <div class="form-text">Ch·ªçn s·∫£n ph·∫©m mu·ªën th√™m v√†o flash sale</div>
                                            </div>

                                            <div class="form-grid-2">
                                                <div class="form-group">
                                                    <label for="giaGoc" class="form-label">
                                                        <i class="fas fa-tag"></i>
                                                        Gi√° g·ªëc *
                                                    </label>
                                                    <div class="input-group">
                                                        <input type="number" class="form-control form-control-lg" 
                                                            id="giaGoc" required min="0" readonly>
                                                        <span class="input-group-text">VNƒê</span>
                                                    </div>
                                                </div>

                                                <div class="form-group">
                                                    <label for="giaFlashSale" class="form-label">
                                                        <i class="fas fa-fire"></i>
                                                        Gi√° Flash Sale *
                                                    </label>
                                                    <div class="input-group">
                                                        <input type="number" class="form-control form-control-lg" 
                                                            id="giaFlashSale" required min="0">
                                                        <span class="input-group-text">VNƒê</span>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="form-label">
                                                    <i class="fas fa-percent"></i>
                                                    Ph·∫ßn trƒÉm gi·∫£m gi√°
                                                </label>
                                                <input type="text" class="form-control form-control-lg discount-display" 
                                                    id="phanTramGiam" readonly placeholder="0%">
                                            </div>

                                            <div class="form-grid-2">
                                                <div class="form-group">
                                                    <label for="soLuongTon" class="form-label">
                                                        <i class="fas fa-cubes"></i>
                                                        S·ªë l∆∞·ª£ng *
                                                    </label>
                                                    <input type="number" class="form-control form-control-lg" 
                                                        id="soLuongTon" required min="1" placeholder="0">
                                                </div>

                                                <div class="form-group">
                                                    <label for="gioiHanMua" class="form-label">
                                                        <i class="fas fa-shopping-cart"></i>
                                                        Gi·ªõi h·∫°n mua/kh√°ch
                                                    </label>
                                                    <input type="number" class="form-control form-control-lg" 
                                                        id="gioiHanMua" min="1" placeholder="Kh√¥ng gi·ªõi h·∫°n">
                                                </div>
                                            </div>

                                            <div class="form-grid-2">
                                                <div class="form-group">
                                                    <label for="thuTu" class="form-label">
                                                        <i class="fas fa-sort-numeric-down"></i>
                                                        Th·ª© t·ª± hi·ªÉn th·ªã
                                                    </label>
                                                    <input type="number" class="form-control form-control-lg" 
                                                        id="thuTu" min="0" value="0">
                                                </div>

                                                <div class="form-group">
                                                    <label for="trangThaiItem" class="form-label">
                                                        <i class="fas fa-toggle-on"></i>
                                                        Tr·∫°ng th√°i
                                                    </label>
                                                    <select class="form-select form-select-lg" id="trangThaiItem">
                                                        <option value="dang_ban">üü¢ ƒêang b√°n</option>
                                                        <option value="het_hang">üî¥ H·∫øt h√†ng</option>
                                                        <option value="tam_dung">‚è∏Ô∏è T·∫°m d·ª´ng</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </form>
                                    </div>

                                    <!-- Action Buttons -->
                                    <div class="form-actions mt-4">
                                        <button type="button" class="btn btn-secondary btn-lg me-2" id="resetProductForm">
                                            <i class="fas fa-undo"></i>
                                            L√†m m·ªõi form
                                        </button>
                                        <button type="button" class="btn btn-primary btn-lg" id="saveProductItemBtn">
                                            <i class="fas fa-save"></i>
                                            <span id="saveProductText">Th√™m s·∫£n ph·∫©m</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- List Section -->
                            <div class="col-lg-7">
                                <div class="table-section-container">
                                    <div class="table-section-header">
                                        <h4 class="section-title">
                                            <i class="fas fa-list"></i>
                                            Danh s√°ch s·∫£n ph·∫©m
                                        </h4>
                                        <div class="table-controls">
                                            <div class="search-box-sm">
                                                <i class="fas fa-search"></i>
                                                <input type="text" id="productSearch" placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m...">
                                            </div>
                                            <button class="btn btn-outline-primary btn-sm" id="refreshProductsBtn">
                                                <i class="fas fa-sync-alt"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <div class="table-container">
                                        <div class="table-responsive">
                                            <table class="products-table" id="productItemsTable">
                                                <thead>
                                                    <tr>
                                                        <th width="25%">S·∫£n ph·∫©m</th>
                                                        <th width="13%">Gi√° g·ªëc</th>
                                                        <th width="13%">Gi√° FS</th>
                                                        <th width="8%">% Gi·∫£m</th>
                                                        <th width="8%">SL</th>
                                                        <th width="8%">ƒê√£ b√°n</th>
                                                        <th width="15%">Tr·∫°ng th√°i</th>
                                                        <th width="10%">Thao t√°c</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="productItemsTableBody">
                                                    <!-- Dynamic products will be loaded here -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- Table Footer -->
                                    <div class="table-footer">
                                        <div class="table-info">
                                            Hi·ªÉn th·ªã <span id="productsCurrentCount">0</span> s·∫£n ph·∫©m
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i>
                        ƒê√≥ng
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- View Details Modal -->
    <div class="modal fade modal-premium" id="viewModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-eye"></i>
                        <span id="viewModalTitle">Chi ti·∫øt Flash Sale</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="view-content" id="viewContent">
                        <!-- Dynamic content will be loaded here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i>
                        ƒê√≥ng
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Modern CSS Reset and Base Styles */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    :root {
        --primary: #667eea;
        --primary-dark: #5a6fd8;
        --secondary: #764ba2;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --dark: #1f2937;
        --light: #f8fafc;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-400: #9ca3af;
        --gray-500: #6b7280;
        --gray-600: #4b5563;
        --gray-700: #374151;
        --gray-800: #1f2937;
        --border-radius: 12px;
        --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        --transition: all 0.3s ease;
    }

    body {
        font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
        background: var(--light);
        color: var(--gray-800);
        line-height: 1.6;
    }

    .main-content {
        min-height: 100vh;
        padding: 24px;
        max-width: 100%;
    }

    /* Header Styles */
    .dashboard-header {
        background: white;
        border-radius: var(--border-radius);
        padding: 28px 32px;
        margin-bottom: 24px;
        box-shadow: var(--shadow);
        border: 1px solid var(--gray-200);
        position: relative;
        overflow: hidden;
    }

    .dashboard-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
    }

    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px;
    }

    .header-title {
        display: flex;
        align-items: center;
        gap: 16px;
    }

    .title-icon {
        font-size: 2.75rem;
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .header-title h1 {
        margin: 0;
        font-size: 1.875rem;
        font-weight: 700;
        color: var(--gray-800);
    }

    .header-title p {
        margin: 4px 0 0 0;
        color: var(--gray-500);
        font-size: 1rem;
    }

    .header-actions {
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
    }

    /* Button Styles */
    .btn-primary {
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 10px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        font-size: 0.95rem;
        transition: var(--transition);
        box-shadow: var(--shadow);
        text-decoration: none;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
    }

    .btn-secondary {
        background: white;
        color: var(--gray-700);
        border: 2px solid var(--gray-300);
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 500;
        font-size: 0.9rem;
        transition: var(--transition);
    }

    .btn-secondary:hover {
        background: var(--gray-100);
        border-color: var(--gray-400);
        transform: translateY(-1px);
    }

    /* Stats Overview */
    .stats-overview {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 24px;
    }

    .stat-card {
        background: white;
        border-radius: var(--border-radius);
        padding: 24px;
        display: flex;
        align-items: center;
        gap: 20px;
        box-shadow: var(--shadow);
        border: 1px solid var(--gray-200);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(to bottom, #fbbf24, #f59e0b);
    }

    .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
    }

    .stat-icon {
        width: 70px;
        height: 70px;
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.75rem;
        box-shadow: var(--shadow);
    }

    .stat-icon.total {
        background: linear-gradient(135deg, #fed7aa, #fdba74);
        color: #ea580c;
    }

    .stat-icon.available {
        background: linear-gradient(135deg, #fef3c7, #fde68a);
        color: #d97706;
    }

    .stat-icon.busy {
        background: linear-gradient(135deg, #ddd6fe, #c4b5fd);
        color: #7c3aed;
    }

    .stat-icon.premium {
        background: linear-gradient(135deg, #c6f6d5, #9ae6b4);
        color: #059669;
    }

    .stat-info h3 {
        margin: 0;
        font-size: 2rem;
        color: var(--gray-800);
        font-weight: 700;
    }

    .stat-info p {
        margin: 4px 0 0 0;
        color: var(--gray-500);
        font-weight: 500;
    }

    /* Search and Filter */
    .search-filter-bar {
        background: white;
        border-radius: var(--border-radius);
        padding: 24px;
        margin-bottom: 24px;
        display: flex;
        gap: 20px;
        align-items: center;
        flex-wrap: wrap;
        box-shadow: var(--shadow);
        border: 1px solid var(--gray-200);
    }

    .search-box {
        display: flex;
        align-items: center;
        background: var(--gray-100);
        border-radius: 10px;
        padding: 12px 20px;
        flex: 1;
        min-width: 400px;
        border: 2px solid var(--gray-200);
        transition: var(--transition);
    }

    .search-box:focus-within {
        border-color: var(--warning);
        box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.1);
    }

    .search-box i {
        color: var(--gray-400);
        margin-right: 12px;
    }

    .search-box input {
        border: none;
        background: none;
        outline: none;
        flex: 1;
        padding: 4px 0;
        font-size: 0.95rem;
        color: var(--gray-800);
    }

    .filter-controls {
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
    }

    .filter-select {
        padding: 10px 16px;
        border: 2px solid var(--gray-200);
        border-radius: 8px;
        background: white;
        color: var(--gray-700);
        min-width: 160px;
        cursor: pointer;
        transition: var(--transition);
        font-size: 0.9rem;
    }

    .filter-select:focus {
        border-color: var(--warning);
        outline: none;
    }

    .clear-filters {
        background: none;
        border: 2px solid var(--gray-200);
        color: var(--gray-600);
        padding: 10px 16px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
        transition: var(--transition);
    }

    .clear-filters:hover {
        background: var(--gray-100);
        border-color: var(--gray-300);
    }

    /* Table Styles */
    .table-container {
        background: white;
        border-radius: var(--border-radius);
        overflow: hidden;
        box-shadow: var(--shadow);
        margin-bottom: 5px;
    }

    .table-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 24px;
        border-bottom: 1px solid var(--gray-200);
        background: var(--gray-50);
    }

    .table-header h3 {
        margin: 0;
        color: var(--gray-800);
        font-size: 1.25rem;
        font-weight: 600;
    }

    .table-actions {
        display: flex;
        gap: 12px;
    }

    .btn-export {
        background: white;
        color: var(--gray-700);
        border: 2px solid var(--gray-300);
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
        font-weight: 500;
        font-size: 0.9rem;
        transition: var(--transition);
    }

    .btn-export:hover {
        background: var(--gray-100);
        border-color: var(--gray-400);
    }

    .table-responsive {
        overflow-x: auto;
    }

    .products-table {
        width: 100%;
        border-collapse: collapse;
    }

    .products-table th {
        background: var(--gray-50);
        padding: 16px 12px;
        text-align: left;
        font-weight: 600;
        color: var(--gray-700);
        border-bottom: 1px solid var(--gray-200);
        font-size: 0.9rem;
        white-space: nowrap;
    }

    .products-table td {
        padding: 16px 12px;
        border-bottom: 1px solid var(--gray-200);
        vertical-align: middle;
    }

    .products-table tbody tr {
        transition: var(--transition);
    }

    .products-table tbody tr:hover {
        background: var(--gray-50);
    }

    .products-table tbody tr:last-child td {
        border-bottom: none;
    }

    /* FlashSale Specific Columns */
    .col-name {
        min-width: 250px;
    }

    .col-date {
        min-width: 200px;
    }

    .col-products {
        width: 100px;
        text-align: center;
    }

    .col-sold {
        width: 80px;
        text-align: center;
    }

    .col-status {
        width: 140px;
    }

    .col-actions {
        width: 150px;
    }

    /* Table Content Styles */
    .flashsale-name {
        font-weight: 600;
        color: var(--gray-800);
        margin-bottom: 4px;
    }

    .flashsale-desc {
        font-size: 0.85rem;
        color: var(--gray-500);
    }

    .date-info {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    .start-date,
    .end-date {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.85rem;
    }

    .start-date {
        color: var(--success);
    }

    .end-date {
        color: var(--danger);
    }

    .product-count,
    .sold-count {
        font-weight: 600;
        color: var(--gray-700);
    }

    /* Status Badges */
    .status-badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        display: inline-block;
    }

    .status-badge.status-cho {
        background: rgba(251, 191, 36, 0.1);
        color: #f59e0b;
    }

    .status-badge.status-dang_dien_ra {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
    }

    .status-badge.status-da_ket_thuc {
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
    }

    .status-badge.status-huy {
        background: rgba(107, 114, 128, 0.1);
        color: #6b7280;
    }

    /* Action Buttons */
    .action-buttons {
        display: flex;
        gap: 6px;
        justify-content: center;
    }

    .btn-action {
        width: 32px;
        height: 32px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
        color: white;
        font-size: 0.9rem;
    }

    .btn-view {
        background: var(--primary);
    }

    .btn-view:hover {
        background: var(--primary-dark);
        transform: scale(1.1);
    }

    .btn-edit {
        background: var(--warning);
    }

    .btn-edit:hover {
        background: #e58e0b;
        transform: scale(1.1);
    }

    .btn-products {
        background: var(--success);
    }

    .btn-products:hover {
        background: #059669;
        transform: scale(1.1);
    }

    .btn-delete {
        background: var(--danger);
    }

    .btn-delete:hover {
        background: #dc2626;
        transform: scale(1.1);
    }

    /* Table Footer */
    .table-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 24px;
        border-top: 1px solid var(--gray-200);
        background: var(--gray-50);
    }

    .table-info {
        color: var(--gray-600);
        font-size: 0.9rem;
    }

    .table-pagination {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .pagination-btn {
        width: 32px;
        height: 32px;
        border: 1px solid var(--gray-300);
        background: white;
        border-radius: 6px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
        color: var(--gray-600);
    }

    .pagination-btn:hover:not(:disabled) {
        background: var(--gray-100);
        border-color: var(--gray-400);
    }

    .pagination-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .pagination-info {
        font-size: 0.9rem;
        color: var(--gray-600);
    }

    /* Empty State */
    .emptyState {
        text-align: center;
        padding: 60px 20px !important;
    }

    .emptyState .empty-icon {
        font-size: 4rem;
        margin-bottom: 20px;
        opacity: 0.7;
    }

    .emptyState .empty-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
    }

    .emptyState .empty-content h3 {
        margin: 0;
        color: var(--gray-800);
        font-size: 1.5rem;
        font-weight: 600;
    }

    .emptyState .empty-content p {
        margin: 0;
        color: var(--gray-500);
        font-size: 1rem;
    }

    .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 80px 40px;
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        border: 1px solid var(--gray-200);
        text-align: center;
    }

    .empty-icon {
        font-size: 4rem;
        margin-bottom: 20px;
        opacity: 0.7;
    }

    .empty-content h3 {
        margin: 0 0 8px 0;
        color: var(--gray-800);
        font-size: 1.5rem;
    }

    .empty-content p {
        margin: 0 0 24px 0;
        color: var(--gray-500);
    }

    /* Loading State */
    .loading-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 60px 20px;
    }

    .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid var(--gray-200);
        border-left: 4px solid var(--warning);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 16px;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Modal Styles */
    .modal-premium .modal-content {
        border: none;
        border-radius: 16px;
        box-shadow: var(--shadow-lg);
        overflow: hidden;
    }

    .modal-premium .modal-header {
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        color: white;
        border-bottom: none;
        padding: 24px 28px;
    }

    .modal-premium .modal-title {
        font-weight: 700;
        font-size: 1.4rem;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .modal-premium .modal-body {
        padding: 28px;
        max-height: 80vh;
        overflow-y: auto;
    }

    .modal-premium .modal-footer {
        border-top: 1px solid var(--gray-200);
        padding: 16px 28px;
        background: white;
    }

    .modal-premium .btn-close {
        filter: invert(1) grayscale(100%) brightness(200%);
    }

    .modal-premium .modal-xl {
        max-width: 1140px;
    }

    .modal-premium .modal-xxl {
        max-width: 1400px;
    }

    .modal-premium .modal-lg {
        max-width: 800px;
    }

    /* Form Styles */
    .form-sections {
        display: flex;
        flex-direction: column;
        gap: 24px;
    }

    .form-section {
        background: var(--gray-50);
        border-radius: 12px;
        padding: 20px;
    }

    .section-title {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 16px;
        color: var(--gray-700);
        font-size: 1.1rem;
        font-weight: 600;
    }

    .section-title i {
        color: var(--warning);
    }

    .form-grid-2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
    }

    .form-group {
        margin-bottom: 16px;
    }

    .form-label {
        font-weight: 600;
        color: var(--gray-700);
        margin-bottom: 8px;
        font-size: 0.95rem;
        display: block;
    }

    .form-control,
    .form-select {
        border: 2px solid var(--gray-200);
        border-radius: 8px;
        padding: 12px;
        font-size: 0.95rem;
        transition: var(--transition);
        background: white;
        width: 100%;
    }

    .form-control:focus,
    .form-select:focus {
        border-color: var(--warning);
        box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.1);
        outline: none;
    }

    .form-text {
        font-size: 0.85rem;
        color: var(--gray-500);
        margin-top: 4px;
    }

    /* Products Modal Specific */
    .form-section-container {
        background: var(--gray-50);
        border-radius: 12px;
        padding: 20px;
        height: fit-content;
    }

    .table-section-container {
        background: white;
        border-radius: 12px;
        padding: 0;
        border: 1px solid var(--gray-200);
        overflow: hidden;
    }

    .table-section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 20px;
        border-bottom: 1px solid var(--gray-200);
        background: var(--gray-50);
    }

    .table-section-header .section-title {
        margin: 0;
    }

    .table-controls {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .search-box-sm {
        display: flex;
        align-items: center;
        background: white;
        border: 1px solid var(--gray-300);
        border-radius: 6px;
        padding: 8px 12px;
        min-width: 200px;
    }

    .search-box-sm i {
        color: var(--gray-400);
        margin-right: 8px;
        font-size: 0.9rem;
    }

    .search-box-sm input {
        border: none;
        background: none;
        outline: none;
        flex: 1;
        font-size: 0.85rem;
        color: var(--gray-800);
    }

    .form-actions {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        padding-top: 16px;
        border-top: 1px solid var(--gray-200);
        margin-top: 16px;
    }

    /* Empty State Small */
    .empty-state-sm {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 40px 20px;
        text-align: center;
        color: var(--gray-500);
    }

    .empty-state-sm .empty-icon {
        font-size: 3rem;
        margin-bottom: 16px;
        opacity: 0.7;
    }

    .empty-state-sm .empty-content h5 {
        margin: 0 0 8px 0;
        color: var(--gray-600);
        font-size: 1.1rem;
    }

    .empty-state-sm .empty-content p {
        margin: 0;
        font-size: 0.9rem;
    }

    /* Discount Display */
    .discount-display {
        background: var(--gray-100) !important;
        color: var(--success) !important;
        font-weight: 600;
    }

    .input-group {
        display: flex;
        border-radius: 8px;
    }

    .input-group .form-control {
        border-radius: 8px 0 0 8px;
        border-right: none;
    }

    .input-group .input-group-text {
        background: var(--gray-100);
        border: 2px solid var(--gray-200);
        border-left: none;
        color: var(--gray-600);
        padding: 12px;
        border-radius: 0 8px 8px 0;
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
        .table-responsive {
            overflow-x: auto;
        }

        .products-table {
            min-width: 900px;
        }
    }

    @media (max-width: 768px) {
        .main-content {
            padding: 16px;
        }

        .header-content {
            flex-direction: column;
            text-align: center;
        }

        .header-actions {
            justify-content: center;
            width: 100%;
        }

        .search-filter-bar {
            flex-direction: column;
        }

        .search-box {
            min-width: auto;
            width: 100%;
        }

        .filter-controls {
            width: 100%;
            justify-content: space-between;
        }

        .filter-select {
            flex: 1;
            min-width: auto;
        }

        .table-header {
            flex-direction: column;
            gap: 16px;
            align-items: flex-start;
        }

        .table-footer {
            flex-direction: column;
            gap: 16px;
            align-items: flex-start;
        }

        .form-grid-2 {
            grid-template-columns: 1fr;
        }

        .stats-overview {
            grid-template-columns: 1fr;
        }

        .modal-premium .modal-body .row {
            flex-direction: column;
        }

        .modal-premium .modal-body .col-lg-5,
        .modal-premium .modal-body .col-lg-7 {
            width: 100%;
            max-width: 100%;
        }
    }

    @media (max-width: 480px) {
        .header-actions {
            flex-direction: column;
            width: 100%;
        }

        .btn-primary,
        .btn-secondary {
            width: 100%;
            justify-content: center;
        }

        .modal-premium .modal-footer {
            flex-direction: column;
            gap: 8px;
        }

        .modal-premium .btn {
            width: 100%;
            justify-content: center;
        }
    }

    @media (max-width: 1400px) {
        .modal-premium .modal-xxl {
            max-width: 95%;
            margin: 1rem auto;
        }
    }

    @media (max-width: 1200px) {
        .modal-premium .modal-xl {
            max-width: 95%;
        }
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Flash Sale Management JavaScript

// State management
let currentPage = 1;
let totalPages = 1;
let flashSales = [];
let currentFlashSaleId = null;
let flashSaleItems = [];

// API endpoints
const API_BASE = '/api/flashsales';

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    loadFlashSales();
    setupEventListeners();
});

// Setup event listeners
function setupEventListeners() {
    // Search and filter
    document.getElementById('searchInput')?.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') applyFilters();
    });
    
    document.getElementById('statusFilter')?.addEventListener('change', applyFilters);
    
    document.getElementById('clearFilters')?.addEventListener('click', () => {
        document.getElementById('searchInput').value = '';
        document.getElementById('statusFilter').value = '';
        currentPage = 1;
        loadFlashSales();
    });

    // Create buttons
    document.getElementById('addFlashSaleBtn')?.addEventListener('click', () => {
        openFlashSaleModal();
    });
    
    document.getElementById('addFlashSaleEmptyBtn')?.addEventListener('click', () => {
        openFlashSaleModal();
    });
    
    document.getElementById('refreshBtn')?.addEventListener('click', () => {
        loadFlashSales();
    });

    // Form submissions
    document.getElementById('flashSaleForm')?.addEventListener('submit', handleFlashSaleSubmit);
    document.getElementById('productItemForm')?.addEventListener('submit', handleProductItemSubmit);
    
    // Save buttons
    document.getElementById('saveFlashSaleBtn')?.addEventListener('click', () => {
        document.getElementById('flashSaleForm').dispatchEvent(new Event('submit'));
    });
    
    document.getElementById('saveProductItemBtn')?.addEventListener('click', () => {
        document.getElementById('productItemForm').dispatchEvent(new Event('submit'));
    });

    // Pagination
    document.getElementById('prevPage')?.addEventListener('click', () => changePage(currentPage - 1));
    document.getElementById('nextPage')?.addEventListener('click', () => changePage(currentPage + 1));

    // Product selection change
    document.getElementById('sanPham')?.addEventListener('change', handleProductSelect);
    
    // Price change to calculate discount
    document.getElementById('giaFlashSale')?.addEventListener('input', calculateDiscount);
    
    // Reset form button
    document.getElementById('resetProductForm')?.addEventListener('click', () => {
        document.getElementById('productItemForm').reset();
        document.getElementById('flashSaleItemId').value = '';
        document.getElementById('phanTramGiam').value = '';
    });
}

// Load Flash Sales
async function loadFlashSales(filters = {}) {
    try {
        const queryParams = new URLSearchParams({
            page: currentPage,
            limit: 10,
            ...filters
        });

        const response = await fetch(`${API_BASE}?${queryParams}`);
        const data = await response.json();

        if (data.success) {
            flashSales = data.data;
            totalPages = data.totalPages || 1;
            renderFlashSales(flashSales);
            updatePagination();
        } else {
            showNotification('L·ªói t·∫£i d·ªØ li·ªáu flash sale', 'error');
        }
    } catch (error) {
        console.error('Error loading flash sales:', error);
        showNotification('L·ªói k·∫øt n·ªëi server', 'error');
    }
}

// Render Flash Sales
function renderFlashSales(data) {
    const tbody = document.querySelector('#flashSalesTable tbody');
    
    if (!tbody) {
        console.error('Table tbody not found');
        return;
    }
    
    if (!data || data.length === 0) {
        return;
    }

    tbody.innerHTML = data.map(fs => `
        <tr data-id="${fs.id}" data-status="${fs.trang_thai}">
            <td class="col-name">
                <div class="flashsale-name">${fs.ten_flash_sale}</div>
                ${fs.mo_ta ? `<div class="flashsale-desc">${fs.mo_ta}</div>` : ''}
            </td>
            <td class="col-date">
                <div class="date-info">
                    <div class="start-date">
                        <i class="fas fa-play-circle"></i>
                        ${formatDateTime(fs.ngay_bat_dau)}
                    </div>
                    <div class="end-date">
                        <i class="fas fa-stop-circle"></i>
                        ${formatDateTime(fs.ngay_ket_thuc)}
                    </div>
                </div>
            </td>
            <td class="col-products">
                <span class="product-count">${fs.so_san_pham || 0} s·∫£n ph·∫©m</span>
            </td>
            <td class="col-sold">
                <span class="sold-count">${fs.tong_da_ban || 0}</span>
            </td>
            <td class="col-status">
                <span class="status-badge status-${fs.trang_thai}">
                    ${getStatusText(fs.trang_thai)}
                </span>
            </td>
            <td class="col-actions">
                <div class="action-buttons">
                    <button class="btn-action btn-view" data-id="${fs.id}" title="Xem chi ti·∫øt">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn-action btn-edit" data-id="${fs.id}" title="Ch·ªânh s·ª≠a">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-action btn-products" data-id="${fs.id}" 
                        data-name="${fs.ten_flash_sale}" title="Qu·∫£n l√Ω s·∫£n ph·∫©m">
                        <i class="fas fa-box"></i>
                    </button>
                    <button class="btn-action btn-delete" data-id="${fs.id}" 
                        data-name="${fs.ten_flash_sale}" title="X√≥a">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        </tr>
    `).join('');
    
    updateTableInfo(data.length, data.length);
    attachTableEventListeners();
}

// Update table info
function updateTableInfo(current, total) {
    const currentCountEl = document.getElementById('currentCount');
    const totalCountEl = document.getElementById('totalCount');
    
    if (currentCountEl) currentCountEl.textContent = current;
    if (totalCountEl) totalCountEl.textContent = total;
}

// Attach event listeners to table action buttons
function attachTableEventListeners() {
    // View buttons
    document.querySelectorAll('.btn-view').forEach(btn => {
        btn.addEventListener('click', function() {
            const id = this.getAttribute('data-id');
            viewFlashSale(id);
        });
    });
    
    // Edit buttons
    document.querySelectorAll('.btn-edit').forEach(btn => {
        btn.addEventListener('click', function() {
            const id = this.getAttribute('data-id');
            editFlashSale(id);
        });
    });
    
    // Products buttons
    document.querySelectorAll('.btn-products').forEach(btn => {
        btn.addEventListener('click', function() {
            const id = this.getAttribute('data-id');
            const name = this.getAttribute('data-name');
            manageProducts(id, name);
        });
    });
    
    // Delete buttons
    document.querySelectorAll('.btn-delete').forEach(btn => {
        btn.addEventListener('click', function() {
            const id = this.getAttribute('data-id');
            const name = this.getAttribute('data-name');
            deleteFlashSale(id, name);
        });
    });
}

// Apply filters
function applyFilters() {
    const status = document.getElementById('statusFilter')?.value;
    const search = document.getElementById('searchInput')?.value;

    const filters = {};
    if (status) filters.trang_thai = status;
    if (search) filters.search = search;

    currentPage = 1;
    loadFlashSales(filters);
}

// Pagination
function changePage(page) {
    if (page < 1 || page > totalPages) return;
    currentPage = page;
    loadFlashSales();
}

function updatePagination() {
    const currentPageEl = document.getElementById('currentPage');
    const totalPagesEl = document.getElementById('totalPages');
    
    if (currentPageEl) currentPageEl.textContent = currentPage;
    if (totalPagesEl) totalPagesEl.textContent = totalPages;
    
    const btnPrev = document.getElementById('prevPage');
    const btnNext = document.getElementById('nextPage');
    
    if (btnPrev) btnPrev.disabled = currentPage === 1;
    if (btnNext) btnNext.disabled = currentPage === totalPages;
}

// Modal Management
function openFlashSaleModal(flashSaleId = null) {
    const modal = new bootstrap.Modal(document.getElementById('flashSaleModal'));
    const form = document.getElementById('flashSaleForm');
    const title = document.getElementById('modalTitle');
    const saveButtonText = document.getElementById('saveButtonText');

    form.reset();

    if (flashSaleId) {
        title.textContent = 'Ch·ªânh s·ª≠a Flash Sale';
        saveButtonText.textContent = 'C·∫≠p nh·∫≠t';
        loadFlashSaleData(flashSaleId);
    } else {
        title.textContent = 'Th√™m Flash Sale m·ªõi';
        saveButtonText.textContent = 'Th√™m Flash Sale';
        document.getElementById('flashSaleId').value = '';
        // Set default dates
        const now = new Date();
        const tomorrow = new Date(now.getTime() + 24 * 60 * 60 * 1000);
        document.getElementById('startDate').value = formatDateTimeLocal(now);
        document.getElementById('endDate').value = formatDateTimeLocal(tomorrow);
    }

    modal.show();
}

// Load Flash Sale data for editing
async function loadFlashSaleData(id) {
    try {
        const response = await fetch(`${API_BASE}/${id}`);
        const data = await response.json();

        if (data.success) {
            const fs = data.data;
            document.getElementById('flashSaleId').value = fs.id;
            document.getElementById('flashSaleName').value = fs.ten_flash_sale;
            document.getElementById('flashSaleDescription').value = fs.mo_ta || '';
            document.getElementById('startDate').value = formatDateTimeLocal(fs.ngay_bat_dau);
            document.getElementById('endDate').value = formatDateTimeLocal(fs.ngay_ket_thuc);
            document.getElementById('flashSaleStatus').value = fs.trang_thai;
        }
    } catch (error) {
        console.error('Error loading flash sale:', error);
        showNotification('L·ªói t·∫£i d·ªØ li·ªáu', 'error');
    }
}

// Handle Flash Sale form submit
async function handleFlashSaleSubmit(e) {
    e.preventDefault();

    const formData = {
        ten_flash_sale: document.getElementById('flashSaleName').value,
        mo_ta: document.getElementById('flashSaleDescription').value,
        ngay_bat_dau: document.getElementById('startDate').value,
        ngay_ket_thuc: document.getElementById('endDate').value,
        trang_thai: document.getElementById('flashSaleStatus').value
    };

    // Validate dates
    if (new Date(formData.ngay_bat_dau) >= new Date(formData.ngay_ket_thuc)) {
        showNotification('Ng√†y k·∫øt th√∫c ph·∫£i sau ng√†y b·∫Øt ƒë·∫ßu', 'error');
        return;
    }

    const flashSaleId = document.getElementById('flashSaleId').value;
    const url = flashSaleId ? `${API_BASE}/${flashSaleId}` : API_BASE;
    const method = flashSaleId ? 'PUT' : 'POST';

    try {
        const response = await fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        });

        const data = await response.json();

        if (data.success) {
            showNotification(flashSaleId ? 'C·∫≠p nh·∫≠t th√†nh c√¥ng' : 'T·∫°o flash sale th√†nh c√¥ng', 'success');
            bootstrap.Modal.getInstance(document.getElementById('flashSaleModal')).hide();
            loadFlashSales();
        } else {
            showNotification(data.message || 'C√≥ l·ªói x·∫£y ra', 'error');
        }
    } catch (error) {
        console.error('Error saving flash sale:', error);
        showNotification('L·ªói k·∫øt n·ªëi server', 'error');
    }
}

// Delete Flash Sale
async function deleteFlashSale(id, name) {
    const result = await Swal.fire({
        title: 'X√°c nh·∫≠n x√≥a',
        html: `B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a flash sale <strong>"${name}"</strong>?<br>T·∫•t c·∫£ s·∫£n ph·∫©m trong flash sale c≈©ng s·∫Ω b·ªã x√≥a.`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#ef4444',
        cancelButtonColor: '#6b7280',
        confirmButtonText: 'X√≥a',
        cancelButtonText: 'H·ªßy'
    });

    if (!result.isConfirmed) return;

    try {
        const response = await fetch(`${API_BASE}/${id}`, {
            method: 'DELETE'
        });

        const data = await response.json();

        if (data.success) {
            showNotification('X√≥a flash sale th√†nh c√¥ng', 'success');
            loadFlashSales();
        } else {
            showNotification(data.message || 'L·ªói x√≥a flash sale', 'error');
        }
    } catch (error) {
        console.error('Error deleting flash sale:', error);
        showNotification('L·ªói k·∫øt n·ªëi server', 'error');
    }
}

// View Flash Sale details
async function viewFlashSale(id) {
    try {
        const response = await fetch(`${API_BASE}/${id}/details`);
        const data = await response.json();

        if (data.success) {
            const fs = data.data;
            const content = `
                <div class="view-section">
                    <h3>Th√¥ng tin chung</h3>
                    <div class="view-row">
                        <span class="view-label">T√™n Flash Sale:</span>
                        <span class="view-value">${fs.ten_flash_sale}</span>
                    </div>
                    <div class="view-row">
                        <span class="view-label">M√¥ t·∫£:</span>
                        <span class="view-value">${fs.mo_ta || 'Kh√¥ng c√≥'}</span>
                    </div>
                    <div class="view-row">
                        <span class="view-label">Tr·∫°ng th√°i:</span>
                        <span class="view-value">
                            <span class="status-badge status-${fs.trang_thai}">
                                ${getStatusText(fs.trang_thai)}
                            </span>
                        </span>
                    </div>
                </div>

                <div class="view-section">
                    <h3>Th·ªùi gian</h3>
                    <div class="view-row">
                        <span class="view-label">Ng√†y b·∫Øt ƒë·∫ßu:</span>
                        <span class="view-value">${formatDateTime(fs.ngay_bat_dau)}</span>
                    </div>
                    <div class="view-row">
                        <span class="view-label">Ng√†y k·∫øt th√∫c:</span>
                        <span class="view-value">${formatDateTime(fs.ngay_ket_thuc)}</span>
                    </div>
                </div>

                <div class="view-section">
                    <h3>Th·ªëng k√™</h3>
                    <div class="view-row">
                        <span class="view-label">S·ªë s·∫£n ph·∫©m:</span>
                        <span class="view-value">${fs.so_san_pham || 0} s·∫£n ph·∫©m</span>
                    </div>
                    <div class="view-row">
                        <span class="view-label">T·ªïng ƒë√£ b√°n:</span>
                        <span class="view-value">${fs.tong_da_ban || 0} s·∫£n ph·∫©m</span>
                    </div>
                    <div class="view-row">
                        <span class="view-label">Doanh thu:</span>
                        <span class="view-value">${formatCurrency(fs.doanh_thu || 0)}</span>
                    </div>
                </div>
            `;

            document.getElementById('viewContent').innerHTML = content;
            const modal = new bootstrap.Modal(document.getElementById('viewModal'));
            modal.show();
        }
    } catch (error) {
        console.error('Error viewing flash sale:', error);
        showNotification('L·ªói t·∫£i d·ªØ li·ªáu', 'error');
    }
}

// Edit Flash Sale
function editFlashSale(id) {
    openFlashSaleModal(id);
}

// Products Management
async function manageProducts(flashSaleId, flashSaleName) {
    currentFlashSaleId = flashSaleId;
    document.getElementById('currentFlashSaleId').value = flashSaleId;
    document.getElementById('productsModalTitle').textContent = `Qu·∫£n l√Ω S·∫£n ph·∫©m - ${flashSaleName}`;

    // Load products
    await loadFlashSaleItems(flashSaleId);
    
    const modal = new bootstrap.Modal(document.getElementById('productsModal'));
    modal.show();
}

// Load Flash Sale Items
async function loadFlashSaleItems(flashSaleId) {
    try {
        const response = await fetch(`${API_BASE}/${flashSaleId}/items`);
        const data = await response.json();

        if (data.success) {
            flashSaleItems = data.data;
            renderFlashSaleItems(flashSaleItems);
        }
    } catch (error) {
        console.error('Error loading flash sale items:', error);
        showNotification('L·ªói t·∫£i danh s√°ch s·∫£n ph·∫©m', 'error');
    }
}

// Render Flash Sale Items
function renderFlashSaleItems(items) {
    const tbody = document.getElementById('productItemsTableBody');
    
    if (!items || items.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="8" style="text-align: center; padding: 30px; color: #6b7280;">
                    <i class="fas fa-inbox" style="font-size: 48px; opacity: 0.5; margin-bottom: 12px; display: block;"></i>
                    Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o
                </td>
            </tr>
        `;
        document.getElementById('productsCurrentCount').textContent = '0';
        return;
    }

    tbody.innerHTML = items.map((item, index) => {
        const discount = ((item.gia_goc - item.gia_flash_sale) / item.gia_goc * 100).toFixed(0);
        return `
            <tr>
                <td>${item.ten_san_pham}</td>
                <td>${formatCurrency(item.gia_goc)}</td>
                <td><strong style="color: #ef4444;">${formatCurrency(item.gia_flash_sale)}</strong></td>
                <td><span class="badge" style="background: #10b981;">-${discount}%</span></td>
                <td>${item.so_luong_ton}</td>
                <td>${item.da_ban || 0}</td>
                <td>
                    <span class="status-badge status-${item.trang_thai}">
                        ${getItemStatusText(item.trang_thai)}
                    </span>
                </td>
                <td>
                    <button class="btn-action btn-edit" onclick="editFlashSaleItem('${item.id}')" title="S·ª≠a">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-action btn-delete" onclick="deleteFlashSaleItem('${item.id}', '${item.ten_san_pham}')" title="X√≥a">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>
        `;
    }).join('');
    
    document.getElementById('productsCurrentCount').textContent = items.length;
}

// Handle product selection
function handleProductSelect(e) {
    const selectedOption = e.target.options[e.target.selectedIndex];
    const price = selectedOption.getAttribute('data-price');
    
    if (price) {
        document.getElementById('giaGoc').value = price;
        calculateDiscount();
    }
}

// Calculate discount percentage
function calculateDiscount() {
    const giaGoc = parseFloat(document.getElementById('giaGoc').value) || 0;
    const giaFlashSale = parseFloat(document.getElementById('giaFlashSale').value) || 0;

    if (giaGoc > 0 && giaFlashSale > 0) {
        const discount = ((giaGoc - giaFlashSale) / giaGoc * 100).toFixed(2);
        document.getElementById('phanTramGiam').value = `-${discount}%`;
    } else {
        document.getElementById('phanTramGiam').value = '';
    }
}

// Handle Product Item form submit
async function handleProductItemSubmit(e) {
    e.preventDefault();

    const formData = {
        flash_sale_id: document.getElementById('currentFlashSaleId').value,
        san_pham_id: document.getElementById('sanPham').value,
        gia_goc: parseFloat(document.getElementById('giaGoc').value),
        gia_flash_sale: parseFloat(document.getElementById('giaFlashSale').value),
        so_luong_ton: parseInt(document.getElementById('soLuongTon').value),
        gioi_han_mua: parseInt(document.getElementById('gioiHanMua').value) || null,
        thu_tu: parseInt(document.getElementById('thuTu').value) || 0,
        trang_thai: document.getElementById('trangThaiItem').value
    };

    // Validate
    if (formData.gia_flash_sale >= formData.gia_goc) {
        showNotification('Gi√° flash sale ph·∫£i nh·ªè h∆°n gi√° g·ªëc', 'error');
        return;
    }

    const itemId = document.getElementById('flashSaleItemId').value;
    const url = itemId 
        ? `${API_BASE}/${currentFlashSaleId}/items/${itemId}` 
        : `${API_BASE}/${currentFlashSaleId}/items`;
    const method = itemId ? 'PUT' : 'POST';

    try {
        const response = await fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        });

        const data = await response.json();

        if (data.success) {
            showNotification(itemId ? 'C·∫≠p nh·∫≠t s·∫£n ph·∫©m th√†nh c√¥ng' : 'Th√™m s·∫£n ph·∫©m th√†nh c√¥ng', 'success');
            document.getElementById('productItemForm').reset();
            document.getElementById('flashSaleItemId').value = '';
            loadFlashSaleItems(currentFlashSaleId);
        } else {
            showNotification(data.message || 'C√≥ l·ªói x·∫£y ra', 'error');
        }
    } catch (error) {
        console.error('Error saving product item:', error);
        showNotification('L·ªói k·∫øt n·ªëi server', 'error');
    }
}

// Edit Flash Sale Item
async function editFlashSaleItem(itemId) {
    try {
        const response = await fetch(`${API_BASE}/${currentFlashSaleId}/items/${itemId}`);
        const data = await response.json();

        if (data.success) {
            const item = data.data;
            
            document.getElementById('flashSaleItemId').value = item.id;
            document.getElementById('sanPham').value = item.san_pham_id;
            document.getElementById('giaGoc').value = item.gia_goc;
            document.getElementById('giaFlashSale').value = item.gia_flash_sale;
            document.getElementById('soLuongTon').value = item.so_luong_ton;
            document.getElementById('gioiHanMua').value = item.gioi_han_mua || '';
            document.getElementById('thuTu').value = item.thu_tu;
            document.getElementById('trangThaiItem').value = item.trang_thai;
            
            calculateDiscount();
            document.getElementById('productFormTitle').textContent = 'Ch·ªânh s·ª≠a s·∫£n ph·∫©m';
            document.getElementById('saveProductText').textContent = 'C·∫≠p nh·∫≠t';
        }
    } catch (error) {
        console.error('Error loading item:', error);
        showNotification('L·ªói t·∫£i d·ªØ li·ªáu s·∫£n ph·∫©m', 'error');
    }
}

// Delete Flash Sale Item
async function deleteFlashSaleItem(itemId, productName) {
    const result = await Swal.fire({
        title: 'X√°c nh·∫≠n x√≥a',
        html: `B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a s·∫£n ph·∫©m <strong>"${productName}"</strong> kh·ªèi flash sale?`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#ef4444',
        cancelButtonColor: '#6b7280',
        confirmButtonText: 'X√≥a',
        cancelButtonText: 'H·ªßy'
    });

    if (!result.isConfirmed) return;

    try {
        const response = await fetch(`${API_BASE}/${currentFlashSaleId}/items/${itemId}`, {
            method: 'DELETE'
        });

        const data = await response.json();

        if (data.success) {
            showNotification('X√≥a s·∫£n ph·∫©m th√†nh c√¥ng', 'success');
            loadFlashSaleItems(currentFlashSaleId);
        } else {
            showNotification(data.message || 'L·ªói x√≥a s·∫£n ph·∫©m', 'error');
        }
    } catch (error) {
        console.error('Error deleting item:', error);
        showNotification('L·ªói k·∫øt n·ªëi server', 'error');
    }
}

// Helper Functions
function formatDateTime(dateString) {
    if (!dateString) return '';
    const date = new Date(dateString);
    return date.toLocaleString('vi-VN', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
    });
}

function formatDateTimeLocal(dateString) {
    if (!dateString) return '';
    const date = new Date(dateString);
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    const hours = String(date.getHours()).padStart(2, '0');
    const minutes = String(date.getMinutes()).padStart(2, '0');
    return `${year}-${month}-${day}T${hours}:${minutes}`;
}

function formatCurrency(amount) {
    return new Intl.NumberFormat('vi-VN', {
        style: 'currency',
        currency: 'VND'
    }).format(amount);
}

function getStatusText(status) {
    const statusMap = {
        'cho': '‚è≥ Ch·ªù',
        'dang_dien_ra': 'üî• ƒêang di·ªÖn ra',
        'da_ket_thuc': '‚úÖ ƒê√£ k·∫øt th√∫c',
        'huy': '‚ùå ƒê√£ h·ªßy'
    };
    return statusMap[status] || status;
}

function getItemStatusText(status) {
    const statusMap = {
        'dang_ban': 'üü¢ ƒêang b√°n',
        'het_hang': 'üî¥ H·∫øt h√†ng',
        'tam_dung': '‚è∏Ô∏è T·∫°m d·ª´ng'
    };
    return statusMap[status] || status;
}

function showNotification(message, type = 'info') {
    const bgColor = type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6';
    
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${bgColor};
        color: white;
        padding: 16px 24px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        z-index: 10001;
        font-weight: 600;
        animation: slideIn 0.3s ease;
    `;
    notification.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i> ${message}`;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// Add CSS animations
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from {
            transform: translateX(400px);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    @keyframes slideOut {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(400px);
            opacity: 0;
        }
    }
    
    .view-section {
        margin-bottom: 24px;
        padding-bottom: 24px;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .view-section:last-child {
        border-bottom: none;
    }
    
    .view-section h3 {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 16px;
    }
    
    .view-row {
        display: flex;
        padding: 12px 0;
        border-bottom: 1px solid #f3f4f6;
    }
    
    .view-row:last-child {
        border-bottom: none;
    }
    
    .view-label {
        width: 200px;
        font-weight: 600;
        color: #6b7280;
    }
    
    .view-value {
        flex: 1;
        color: #1f2937;
    }
`;
document.head.appendChild(style);
</script>
