<div id="container">
  <div class="banner-container">
    <div class="banner">
      <button class="banner-btn banner-prev" id="bannerPrev">
        <i class="fas fa-chevron-left"></i>
      </button>
      <div class="banner-track" id="bannerTrack">
        <img src="/image/img1.webp" alt="Ad 1">
        <img src="/image/img2.webp" alt="Ad 2">
        <img src="/image/img3.webp" alt="Ad 3">
        <img src="/image/img4.webp" alt="Ad 4">
      </div>
      <button class="banner-btn banner-next" id="bannerNext">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
    <div class="banner-dots" id="bannerDots"></div>
  </div>

  <div id="wrapper">
    <!-- FLASH SALE Section -->
    <div class="sale_polular">
      <h1>FLASH SALE</h1>

      <div class="products">
        {{#if flashSaleProducts}}
          {{#each flashSaleProducts}}
            {{> product}}
          {{/each}}
        {{else}}
          <p class="no-data">Không có sản phẩm flash sale</p>
        {{/if}}
      </div>
    </div> 

    <!-- iPhone Section -->
    <div class="ListContainer1">
      <h1><img src="/image/apple_logo.png" style="width: 30px; height: 30px"> iPhone</h1>

      <div class="products">
        {{#if iphoneProducts}}
          {{#each iphoneProducts}}
            {{> product}}
          {{/each}}
        {{else}}
          <p class="no-data">Không có sản phẩm iPhone</p>
        {{/if}}
      </div>
    </div>

    <!-- All Products Section -->
    <div class="ListContainer1">
      <h1>TẤT CẢ SẢN PHẨM</h1>

      <div class="products" id="productGrid">
        {{#if sanphams}}
          {{#each sanphams}}
            {{> product}}
          {{/each}}
        {{else}}
          <p class="no-data">Không có sản phẩm nào</p>
        {{/if}}
      </div>
    </div>

  </div>
</div>

<!-- Modal xem nhanh sản phẩm -->
<div class="product-quickview-modal" id="quickviewModal">
  <div class="product-modal-content">
    <span class="product-modal-close">&times;</span>
    <div class="product-modal-body">
      <div class="row">
        <div class="col-md-6">
          <img class="product-modal-image" id="modalProductImage" src="" alt="">
        </div>
        <div class="col-md-6">
          <div class="product-modal-info">
            <h3 id="modalProductName"></h3>
            <p id="modalProductSKU" class="text-muted"></p>
            <div id="modalProductPrice" class="modal-price"></div>
            <div id="modalProductStock" class="modal-stock"></div>
            <div class="modal-actions">
              <button class="btn btn-primary">
                <i class="fas fa-cart-plus me-2"></i> Thêm vào giỏ hàng
              </button>
              <button class="btn btn-success">
                <i class="fas fa-bolt me-2"></i> Mua ngay
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // JavaScript cho chức năng banner và sản phẩm
  document.addEventListener('DOMContentLoaded', function () {
    // Banner Slider Logic
    const bannerTrack = document.getElementById('bannerTrack');
    const bannerPrev = document.getElementById('bannerPrev');
    const bannerNext = document.getElementById('bannerNext');
    const bannerDotsContainer = document.getElementById('bannerDots');
    const images = bannerTrack.querySelectorAll('img');
    const totalImages = images.length;
    let currentIndex = 0;

    // Clear and create dots
    bannerDotsContainer.innerHTML = '';
    for (let i = 0; i < totalImages; i++) {
      const dot = document.createElement('div');
      dot.classList.add('banner-dot');
      if (i === 0) dot.classList.add('active');
      dot.setAttribute('data-index', i);
      dot.addEventListener('click', function() {
        goToSlide(parseInt(this.getAttribute('data-index')));
      });
      bannerDotsContainer.appendChild(dot);
    }

    function updateSlider() {
      // Update track position
      const offset = -currentIndex * 100;
      bannerTrack.style.transform = `translateX(${offset}%)`;
      
      // Update dots
      const allDots = bannerDotsContainer.querySelectorAll('.banner-dot');
      allDots.forEach((dot, index) => {
        if (index === currentIndex) {
          dot.classList.add('active');
        } else {
          dot.classList.remove('active');
        }
      });
    }

    function goToSlide(index) {
      currentIndex = index;
      updateSlider();
    }

    function nextSlide() {
      currentIndex = (currentIndex + 1) % totalImages;
      updateSlider();
    }

    function prevSlide() {
      currentIndex = (currentIndex - 1 + totalImages) % totalImages;
      updateSlider();
    }

    bannerNext.addEventListener('click', nextSlide);
    bannerPrev.addEventListener('click', prevSlide);

    // Auto slide every 10 seconds
    let autoSlideInterval = setInterval(nextSlide, 10000);

    // Pause auto slide on hover
    bannerTrack.addEventListener('mouseenter', function() {
      clearInterval(autoSlideInterval);
    });

    // Resume auto slide on mouse leave
    bannerTrack.addEventListener('mouseleave', function() {
      autoSlideInterval = setInterval(nextSlide, 10000);
    });

    // Lấy tất cả các nút "XEM NHANH"
    const viewButtons = document.querySelectorAll('.product-view-btn');
    const modal = document.getElementById('quickviewModal');
    const modalImage = document.getElementById('modalProductImage');
    const modalName = document.getElementById('modalProductName');
    const modalSKU = document.getElementById('modalProductSKU');
    const modalPrice = document.getElementById('modalProductPrice');
    const modalStock = document.getElementById('modalProductStock');
    const closeBtn = document.querySelector('.product-modal-close');

    // Xử lý click nút "XEM NHANH"
    viewButtons.forEach(button => {
      button.addEventListener('click', function () {
        const productId = this.getAttribute('data-product-id');
        const card = this.closest('.product-card');
        const image = card.querySelector('.product-image-container img');
        const name = card.querySelector('.product-name').textContent;
        const sku = card.querySelector('.product-sku').textContent;
        const price = card.querySelector('.product-price').textContent;
        const status = card.querySelector('.product-status-badge').textContent.trim();
        
        // Hiển thị thông tin trong modal
        modalImage.src = image.src;
        modalImage.alt = image.alt;
        modalName.textContent = name;
        modalSKU.textContent = sku;
        modalPrice.textContent = price;
        modalStock.textContent = status;

        // Hiển thị modal
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
      });
    });

    // Đóng modal khi click nút close
    closeBtn.addEventListener('click', function () {
      modal.style.display = 'none';
      document.body.style.overflow = 'auto';
    });

    // Đóng modal khi click bên ngoài
    modal.addEventListener('click', function (e) {
      if (e.target === modal) {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
      }
    });

    // Đóng modal bằng phím ESC
    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape' && modal.style.display === 'flex') {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
      }
    });

    // Xử lý thêm vào giỏ hàng
    const cartButtons = document.querySelectorAll('.product-cart-btn');
    cartButtons.forEach(button => {
      button.addEventListener('click', function() {
        const productId = this.getAttribute('data-product-id');
        // Gọi API thêm vào giỏ hàng
        console.log('Thêm sản phẩm vào giỏ:', productId);
        
        // Hiệu ứng thông báo
        const originalText = this.innerHTML;
        this.innerHTML = '<i class="fas fa-check me-2"></i> ĐÃ THÊM';
        this.style.background = '#27ae60';
        this.style.color = 'white';
        
        setTimeout(() => {
          this.innerHTML = originalText;
          this.style.background = '';
          this.style.color = '';
        }, 2000);
      });
    });

    // Xử lý mua ngay
    const buyButtons = document.querySelectorAll('.product-buy-btn');
    buyButtons.forEach(button => {
      button.addEventListener('click', function() {
        const productId = this.getAttribute('data-product-id');
        // Chuyển đến trang thanh toán
        console.log('Mua ngay sản phẩm:', productId);
        window.location.href = `/checkout?product=${productId}`;
      });
    });
  });
</script>